@model TAMHR.ESS.Domain.APARRefillViewModel
@{
    var isNew = Model.Id == default(Guid);
}

<script>
    //Fungsi untuk mendapatkan nilai parameter dari URL
    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function populateFilters() {
        var divisionCode = getUrlParameter('DivisionCode');
        var areaId = getUrlParameter('AreaId');
        var divisionComboBox = $("#DivisionCode").data("kendoComboBox");
        var areaComboBox = $("#AreaId").data("kendoComboBox");

        if (divisionCode && $("#DivisionCode").data("kendoComboBox")) {
            $("#DivisionCode").data("kendoComboBox").value(divisionCode);
            divisionComboBox.readonly(true);
        }

        if (areaId && areaComboBox) {
            areaComboBox.dataSource.read(); // Load ulang data area
            areaComboBox.value(areaId.toUpperCase());
            areaComboBox.readonly(true);
        }
    }
</script>

<script>
    $(document).ready(function() {
         // Ambil instance ComboBox
        var divisionComboBox = $("#DivisionCode").data("kendoComboBox");
        var areaComboBox = $("#AreaId").data("kendoComboBox");

         // Cek apakah ini mode edit atau tambah data
        var isNew = @Json.Serialize(isNew);
        var areaId = @Json.Serialize(Model.AreaId);
        var divisionCode = @Json.Serialize(Model.DivisionCode);

        if (!isNew && areaId) {
            areaComboBox.enable(true); // Aktifkan area jika ada nilai saat update
            areaComboBox.dataSource.read(); // Muat ulang data agar NamaArea muncul
        } else {
            areaComboBox.enable(false);
        }

         // Event ketika Divisi berubah
         divisionComboBox.bind("change", function() {
             var divisionCode = this.value();

             if (divisionCode) {
                 areaComboBox.enable(true); // Aktifkan Area jika Divisi dipilih
                 areaComboBox.dataSource.read(); // Load ulang data area
             } else {
                 areaComboBox.enable(false); // Nonaktifkan jika Divisi kosong
                 areaComboBox.value(""); // Kosongkan pilihan area
             }
         });

         //Ambil instance ComboBox
        var useAparFor = $("#UseAparFor").data("kendoComboBox");
        var remarkInput = $("#Remark");

        //Bind event change ke ComboBox
        useAparFor.bind("change", function () {
            toggleRemark();
        });

        //Fungsi untuk mengontrol readonly berdasarkan pilihan
        function toggleRemark() {
            var selectedValue = useAparFor.value();
            if (selectedValue === "Lain") {
                remarkInput.prop("readonly", false); //Aktifkan input
            } else {
                remarkInput.prop("readonly", true).val(""); //Nonaktifkan dan kosongkan input
            }
        }

        //Panggil sekali saat halaman dimuat (jika dalam mode edit)
        toggleRemark();
        populateFilters();
     });

     // Function untuk filter area berdasarkan Divisi
     function filterArea() {
         return {
             divisionCode: $("#DivisionCode").data("kendoComboBox").value(),
         };
     }
</script>

<form enctype="multipart/form-data" method="@(isNew ? "post" : "put")" action="@(isNew ? "~/api/ohs/area-activity/insertAparRefill" : "~/api/ohs/area-activity/updateAparRefill")">
    @Html.HiddenFor(x => x.Id)

        <div class="row">
            <div class="col-md-6 col-12">
                <div class="form-group">
                    <label><span class="required" aria-required="true"> * </span>@Localizer["Merk"]</label>
                    @Html.TextBoxFor(x => x.Merk, new { @class = "form-control", @data_validation_for = "Merk", @placeholder = Localizer["Please input Merk"].Value })
                    <span class="invalid"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-12">
                <div class="form-group">
                    <label><span class="required" aria-required="true"> * </span>@Localizer["Type"]</label>
                    @Html.TextBoxFor(x => x.Type, new { @class = "form-control", @data_validation_for = "Type", @placeholder = Localizer["Please input Type"].Value })
                    <span class="invalid"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-6">
                <div class="form-group">
                    <label><span class="required" aria-required="true"> * </span>@Localizer["Divisi"]</label>
                    @(Html.Kendo().ComboBox()
                        .Name("DivisionCode")
                        .HtmlAttributes(new { @class = "form-control", data_validation_for = "DivisionCode", @required = "required" })
                        .DataTextField("ObjectText")
                        .DataValueField("ObjectCode")
                        .Placeholder(Localizer["Please select Divisi"].Value)
                        .Value(Model.DivisionCode ?? string.Empty)
                        .DataSource(dataSource => dataSource
                        .Ajax()
                        .Read(read => read.Url(Url.Content("~/api/ohs/area-activity/gets-Divisi")))
                        .Sort(sort => sort.Add("ObjectText"))
                        )
                        .SelectedIndex(-1)
                        )
                    <span class="invalid" data-validation-for="DivisiCode"></span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 col-6">
                <div class="form-group">
                    <label><span class="required" aria-required="true"> * </span>@Localizer["Area"]</label>
                    @(Html.Kendo().ComboBox()
                        .Name("AreaId")
                        .HtmlAttributes(new { @class = "form-control", data_validation_for = "AreaId", @required = "required" })
                        .DataTextField("NamaArea")
                        .DataValueField("Id")
                        .Placeholder(Localizer["Please select Area"].Value)
                        .Value(Model.AreaId ?? string.Empty)
                        .DataSource(dataSource => dataSource
                        .Ajax()
                        .Read(read => read.Url(Url.Content("~/api/ohs/area-activity/gets-AreaDropDown"))
                        .Data("filterArea"))
                        .Sort(sort => sort.Add("NamaArea"))
                        )
                        )
                    <span class="invalid" data-validation-for="AreaId"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-12">
                <div class="form-group">
                <label><span class="required" aria-required="true"> * </span>@Localizer["Qty (Unit)"]</label>
                @Html.TextBoxFor(x => x.Qty, new { @class = "form-control", @data_validation_for = "Qty", @placeholder = Localizer["Please input Qty"].Value })
                    <span class="invalid"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-6">
                <div class="form-group">
                    <label><span class="required" aria-required="true"> * </span>@Localizer["Keterangan Penggunaan APAR"]</label>
                    @(Html.Kendo().ComboBox()
                        .Name("UseAparFor")
                        .HtmlAttributes(new { @class = "form-control", data_validation_for = "Keterangan Penggunaan APAR", @required = "required" })
                        .DataTextField("Name")
                        .DataValueField("Name")
                        .Placeholder(Localizer["Please select Keterangan Penggunaan APAR"].Value)
                        .Value(Model.UseAparFor == default(string) ? string.Empty : Model.UseAparFor)
                        .DataSource(dataSource => dataSource
                        .Ajax()
                        .Read(read => read.Url(Url.Content("~/api/ohs/area-activity/getGeneralCategory?category=OHSKetAPAR")))
                        .Sort(sort => sort.Add("Name"))

                        ))
                        <span class="invalid" data-validation-for="UseAparFor"></span>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-12">
                <div class="form-group">
                <label>@Localizer["Remark"]</label>
                @Html.TextBoxFor(x => x.Remark, new { @id = "Remark", @class = "form-control", @data_validation_for = "Remark", @placeholder = Localizer["Please input Remark"].Value, @readonly = "readonly" })
                <span class="invalid"></span>
                </div>
            </div>
        </div>
    <div class="actions">
        <a class="btn red-haze" data-trigger="submit" data-callback="updateHandler">@Localizer["Save"]</a>
    </div>
</form>