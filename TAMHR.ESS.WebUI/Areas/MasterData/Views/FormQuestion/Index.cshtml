@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject TAMHR.ESS.Infrastructure.Web.Authorization.AclHelper AclHelper
@inject TAMHR.ESS.Infrastructure.DomainServices.FormService FormService
@{

    var doctorView = AclHelper.HasPermission("Core.FormQuestion.ViewDoctorOnly");

    List<Form> dropdownList = new List<Form>();
    if (doctorView)
    {
        var dropdown = FormService.Get("vaccine");
        dropdownList.Add(dropdown);
    }
    else
    {
        dropdownList = FormService.Gets().ToList();
    }
}
@section scripts {
    <partial name="_Script" />
}
<div class="card">
    <div class="row no-gutters">
        <div class="col-md-4">
            <div class="p-4" style="height: 100%; background-color: #eff2f7;">
                <div class="section-heading d-block d-md-none">
                    <p class="text-uppercase font-weight-bold mb-0">@Localizer["Questioner Form"]</p>
                    <h5 class="text-header m-0">
                        @Localizer["Questioner form master data."]
                    </h5>
                </div>
                <div class="d-none d-md-flex position-sticky">
                    <img src="~/img/assets/asset-16.png" alt="login" class="mx-auto my-5" style="width: 65%;">
                </div>
            </div>
        </div>
        <div class="col-md-8 col-12">
            <div class="card-body material">
                <div class="section-heading mb-2 d-none d-md-block">
                    <p class="text-uppercase font-weight-bold mb-0">@Localizer["Questioner Form"]</p>
                    <h5 class="text-header m-0">
                        @Localizer["Questioner form master data."]
                    </h5>
                </div>
                <div class="form-group">
                    <label>@Localizer["Form"]</label>
                    @(Html.Kendo().ComboBox().Name("FormId")
                        .HtmlAttributes(new { @class = "form-control", data_validation_for = "FormId" })
                        .DataTextField("Title")
                        .DataValueField("Id")
                        .Placeholder(Localizer["Please select form"].Value)
                        //.DataSource(dataSource => dataSource
                        //    .Ajax()
                        //    .Read(read => read.Url(Url.Content(urlData)))
                        //)
                        .BindTo(dropdownList)
                        .Events(events => events.Change("$.onFormChange"))
                        .Deferred()
                    )
                </div>
                <div class="form-group">
                    <label>@Localizer["Questioner"]</label>
                    <div id="message-wrapper">
                        @Localizer["Please select form first"]
                    </div>
                    <div id="question-wrapper" class="wrapper hidden">
                        <div class="no-table-header mt-3">
                            @(Html.Kendo().Grid<TAMHR.ESS.Domain.FormQuestion>()
                                .Name("questionRootGrid")
                                .Columns(columns =>
                                {
                                    columns.Bound(o => o.Title)
                                        .Title(Localizer["Question"].Value)
                                        .ClientTemplate(
                                            @"<div class=""d-flex align-items-center"">
                                                <a href=""javascript:;"" data-trigger=""modal"" data-modal=""generic-modal"" data-title=""Edit Question"" data-modal-ajax=""true"" data-ajax-url=""~/masterdata/formquestion/load"" data-parameters-id=""#:Id#"">
                                                    <span class=""row-number""></span> #:Title#
                                                </a>
                                                <a class=""ml-auto font-medium-3"" data-trigger=""handler"" data-url=""~/api/form-question/soft-delete"" data-handler=""deleteHandler"" data-parameters-id=""#:Id#""><i class=""fa fa-times-circle""></i></a>
                                            </div>"
                                        );
                                })
                                .AutoBind(false)
                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No data found"].Value + "</div>"))
                                .ClientDetailTemplateId("formQuestionDetailTpl")
                                .DataSource(dataSource => dataSource
                                    .Ajax()
                                    .Read(read => read.Url(Url.Content("~/api/form-question/get-roots")).Data("$.gridData"))
                                    .Sort(sort =>
                                    {
                                        sort.Add(x => x.OrderSequence);
                                    })
                                )
                                .Events(events =>
                                {
                                    events.DataBound("function() { $.rowNumber.call(this); $.initDraggable.call(this, '>tbody >tr:not(.k-detail-row)', $.onSuccessDrag); }");
                                })
                                .Deferred()
                            )
                        </div>
                        <div class="mt-3 d-flex">
                            <a id="createQuestionBtn" data-target="questionRootGrid" class="btn red-flamingo" href="javascript:;" data-trigger="modal" data-title="Create new Question" data-modal="generic-modal" data-modal-ajax="true" data-ajax-url="~/masterdata/formquestion/load">
                                @Localizer["Add new Question"]
                            </a>
                            <a class="btn blue-sharp ml-3" href="javascript:;" data-trigger="modal" data-title="Manage Rules" data-modal="generic-modal" data-modal-ajax="true" data-ajax-url="~/masterdata/formquestion/loadrules">
                                @Localizer["Manage Rules"]
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>