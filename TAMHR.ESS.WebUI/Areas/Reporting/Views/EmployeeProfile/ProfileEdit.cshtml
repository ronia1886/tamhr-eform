@inject TAMHR.ESS.Infrastructure.DomainServices.ConfigService ConfigService
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ScriptManager.RegisterReferences("dropdownlist", "grid", "datepicker", "combobox", "upload");
    //ScriptManager.RegisterReferences("grid");
    //var PersonalData = ViewData["PersonalData"] as List<EmployeeeOrganizationObjectStoredEntity>;
    var PersonalData = ViewData["PersonalData"] as List<EmployeeOrganizationObjectStoredEntityNew>;
    var ProfileData = ViewData["ProfileDatas"] as PersonalDataAllProfileStoredEntity;
    var ListProfileData = new List<PersonalDataAllProfileStoredEntity>();
    ListProfileData.Add(ProfileData);
    var emContact = ViewData["emcContact"] as PersonalDataEmergencyContactStoredProcedure;
    var eduData = ViewData["Education"] as IEnumerable<ProfileDataEducationStoreEntity>;
    var eduDatas = ViewData["EducationData"] as IEnumerable<dynamic>;
    var HBC = ViewData["HistoryBenefitClaim"] as IEnumerable<HistoryClaimStoreEntity>;
    var Educations = ViewData["Education"] as List<ProfileDataEducationStoreEntity>;
    var HistoryBenefitClaim = ViewData["HistoryBenefitClaim"] as IEnumerable<HistoryClaimStoreEntity>;
    var famData = ViewData["FamilyMember"] as IEnumerable<PersonalDataFamilyMemberStoredEntity>;
    var FamilyMembers = ViewData["FamilyMember"] as List<PersonalDataFamilyMemberStoredEntity>;
    var organizationalAssignments = ViewData["OrganizationalAssignment"] as IEnumerable<OrganizationalAssignmentStoredEntity>;
    var DataTraining = ViewData["DataTraining"];
    var claimTypes = ViewData["claimType"] as IEnumerable<string>;
    var training = ViewData["DataTraining"] as IEnumerable<object>;
    var photo = ViewData["Photo"];
    var maxFileSize = 5 * 1000000;
    var ds = @Html.Raw(HistoryBenefitClaim);
    var statusemp = ViewData["Status"];
    var contract = ViewData["Contract"];
    //var claimTypes = ViewData["claimType"];
    
}


@{
    var employeeCategory = ViewData["Expr1"]?.ToString();
    var isTerminated = employeeCategory != null && employeeCategory.ToLower() == "terminated";
}

@* untuk validasi jika entry date sama *@
@{
    var startDateTAM = PersonalData?[0]?.TamDate;
    var entryDateAstra = PersonalData?[0]?.EntryDate;
    bool showAstra = entryDateAstra != default(DateTime) && startDateTAM != entryDateAstra;
}

@section scripts {
    <partial name="_Style" />
        <script id="dataBenefitClaim-template" type="text/x-kendo-template">
            # var obj = JSON.parse(JsonObject); #
            <table class="table-bordered">
                <tr>
                    <th class="font-weight-bold" style="width: 300px; border: 1px solid;">Tipe Benefit Claim</th>
                    <td style="border: 1px solid;">#: AllowanceType #</td>
                </tr>
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Bulan Tahun Transaksi Claim</th>
                    <td style="border-width: 0 0 0 0px;">#: monthActivity # #: yearActivity #</td>
                </tr>
                # if (AllowanceType == 'Reimburse RS') { #
                # if (obj.FamilyType == 'rspasangan' || obj.FamilyType == 'rskaryawan') { #
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Nama Pasien</th>
                    <td style="border-width: 0 0 0 0px;">#: obj.FamilyName #</td>
                </tr>
                # if (obj.FamilyType == 'rspasangan') { #
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Hubungan</th>
                    <td style="border-width: 0 0 0 0px;">Pasangan</td>
                </tr>
                # } } else if (obj.FamilyType == 'rsanak') { #
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Nama Pasien</th>
                    <td style="border-width: 0 0 0 0px;">#: obj.FamilyName #</td>
                </tr>
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Hubungan</th>
                    <td style="border-width: 0 0 0 0px;">Anak</td>
                </tr>
                # } #
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Tipe Reimburse</th>
                    <td style="border-width: 0 0 0 0px;">#: (obj.ReimburseType == 'rawatjalankontrol' ? 'Rawat Jalan / Kontrol' : 'Perawatan / Inap') #</td>
                </tr>
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Nama Rumah Sakit</th>
                    <td style="border-width: 0 0 0 0px;">#: obj.HospitalName #</td>
                </tr>
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Tanggal Perawatan</th>
                    <td style="border-width: 0 0 0 0px;">#: (obj.DateIn == obj.DateOut ? obj.DateIn : (obj.DateIn + " - " + obj.DateOut)) #</td>
                </tr>
                # } #
                <tr>
                    <th class="font-weight-bold" style="width: 300px;border: none;">Amount Transaksi Claim</th>
                    <td style="border-width: 0 0 0 0px;">Rp #= kendo.toString(amount , 'n0') # </td>
                </tr>
            </table>

        </script>
    <script type="text/javascript">
        var anakke = 0;
        function BindAnak() {
            anakke += 1
            return anakke;
        }

        function openCity(evt, cityName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // function BindGrid() {
        //     var dataClaimBenefit = @Html.Raw(HistoryBenefitClaim);
        //     $("#benefitClaimGrid1").kendoGrid({
        //         columns: [{
        //             field: "Noreg",
        //             template: kendo.template($("#dataBenefitClaim-template").html())
        //         }],
        //         noRecords: {
        //             template: '<div class="text-center p-2 text-muted"><i class="fa fa-clipboard font-large-1"></i><br/>No Records Found</div>'
        //         },
        //         dataSource: dataClaimBenefit,
        //         pageable: {
        //             input: true,
        //             numeric: false,
        //             alwaysVisible: false,
        //             pageSize: 5,
        //         },
        //     });
        // }

        function filterGrid() {
            $("#benefitClaimGrid1").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    {
                        field: "AllowanceType",
                        operator: "startswith",
                        value: $("#nama").val()
                    },
                    {
                        field: "yearActivity",
                        operator: "startswith",
                        value: $("#nama").val()
                    }
                ]
            });
        }

        function filterGrid1() {
            var selectedClaimType = $("#claimTypeDropdown").val();

            $("#HCBGrid").data("kendoGrid").dataSource.filter({
                logic: "or",
                filters: [
                    {
                        field: "AllowanceType",
                        operator: "eq",
                        value: selectedClaimType
                    },
                    {
                        field: "yearActivity",
                        operator: "eq",
                        value: selectedClaimType
                    }
                ]
            });
        }

        function filterGrid23() {
            var selectedClaimType = $("#claimTypeDropdown").val();
            var grid = $("#HCBGrid").data("kendoGrid");
            var namaPasienColumn = grid.columns.filter(function (column) {
                //return column.field === "JsonObject" && column.title === "Nama Pasien";
                return column.field === "JsonObject" && column.title === "Patient's name";
            })[0];
            var namaHospitalColumn = grid.columns.filter(function (column) {
                //return column.field === "JsonObject" && column.title === "Nama Rumah Sakit";
                return column.field === "JsonObject" && column.title === "Hospital Name";
            })[0];
            var namaTipeReimburse = grid.columns.filter(function (column) {
                //return column.field === "JsonObject" && column.title === "Tipe Reimburse";
                return column.field === "JsonObject" && column.title === "Reimbursement Type";
            })[0];
            var namaTanggalPerawatan = grid.columns.filter(function (column) {
                //return column.field === "JsonObject" && column.title === "Tanggal Perawatan";
                return column.field === "JsonObject" && column.title === "Date of Treatment";
            })[0];
            var namaHubungan = grid.columns.filter(function (column) {
                //return column.field === "JsonObject" && column.title === "Hubungan";
                return column.field === "JsonObject" && column.title === "Relationshiop";
            })[0];

            if (selectedClaimType === "Reimburse RS") {
                // Menampilkan kolom "Nama Pasien"
                //console.log("test1");
                grid.showColumn(namaPasienColumn);
                //console.log("test2");
                grid.showColumn(namaHospitalColumn);
                grid.showColumn(namaTipeReimburse);
                grid.showColumn(namaTanggalPerawatan);
                grid.showColumn(namaHubungan);
            } else {
                // Menyembunyikan kolom "Nama Pasien"
                //console.log("test-1");
                grid.hideColumn(namaPasienColumn);
                //console.log("test1-2");
                grid.hideColumn(namaHospitalColumn);
                grid.hideColumn(namaTipeReimburse);
                grid.hideColumn(namaTanggalPerawatan);
                grid.hideColumn(namaHubungan);
            }

            grid.dataSource.filter({
                logic: "or",
                filters: [
                    {
                        field: "AllowanceType",
                        operator: "eq",
                        value: selectedClaimType
                    },
                    {
                        field: "yearActivity",
                        operator: "eq",
                        value: selectedClaimType
                    }
                ]
            });
        }

        /*function toggleGridVisibility() {
            var selectedClaimType = $("#claimTypeDropdown1").val();
            var reimburseGrid = $("#HCBGridReimburseRS").data("kendoGrid");
            var rs = document.getElementById("HCBGridReimburseRS");
            var nonReimburseGrid = $("#HCBGridOther").data("kendoGrid");

            if (selectedClaimType === "Reimburse RS") {
                console.log(selectedClaimType);
                console.log("Sebelum mengubah visibilitas");
                reimburseGrid.show();
                nonReimburseGrid.hide();
                console.log("Setelah mengubah visibilitas");
            } else {
                console.log(selectedClaimType);
                console.log("Sebelum mengubah visibilitas1");
                //reimburseGrid.wrapper.hide();
                //rs.style.display = "none";
                $("#HCBGridReimburseRS").hide();
                $("#HCBGridOther").show();
                //nonReimburseGrid.wrapper.show();
                console.log("Setelah mengubah visibilitas1");
            }
        }

        $("#toggleGridButton").click(function() {
            toggleGridVisibility();
        });*/
        

        $(document).ready(function () {
            // BindGrid();
            //toggleGridVisibility();
            $("#uploadButton").click(function () {
                var formData = new FormData();
                var fileInput = document.getElementById("fileInput");
                var noreg = @Html.Encode(ProfileData.NoReg);
                formData.append("photo", fileInput.files[0]);
                formData.append("noreg", noreg);

                $.ajax({
                    url: app.resolveUrl("~/api/employe-profile/upload"),
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        // Handle success response from the API
                        console.log(response);
                    },
                    error: function (error) {
                        // Handle error response from the API
                        console.error(error);
                    }
                });
            });
        });

        $("#fileInput").change(function () {
            var fileInput = document.getElementById("fileInput");
            var noreg = @Html.Encode(ProfileData.NoReg);

            if (fileInput.files && fileInput.files.length > 0) {
                var formData = new FormData();
                formData.append("photo", fileInput.files[0]);
                formData.append("noreg", noreg);

                $.ajax({
                    url: app.resolveUrl("~/api/employe-profile/upload"),
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        // Handle success response from the API
                        //console.log(response);
                        location.reload();
                    },
                    error: function (error) {
                        // Handle error response from the API
                        console.error(error);
                    }
                });
            }
        });

    </script>
    <script>
        const familyTypeFields = {
            "Anak Tiri": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "feducationLevels", "fjob", "insuranceenoo", "childStatus", "freligion", "gender", "fnationality", "bpjshealths"],
            "Kakek Dari Ibu": ["names", "LifeStatus"],
            "Nenek Dari Ibu": ["names", "LifeStatus"],
            "Ibu": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "fdomicile", "feducationLevels", "fjob"],
            "Anak Angkat": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "feducationLevels", "fjob", "gender", "insuranceenoo", "childStatus", "freligion", "fnationality", "bpjshealths"],
            "Saudara": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "fdomicile", "feducationLevels", "fjob", "gender"],
            "Suami / Istri": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "fdomicile", "feducationLevels", "fjob", "gender", "insuranceenoo", "freligion", "fnationality", "bpjshealths", "addressStatus", "residentialStatuss"],
            "Kakek Dari Ayah": ["names", "LifeStatus"],
            "Nenek Dari Ayah": ["names", "LifeStatus"],
            "Kakek/Nenek dari Ibu": ["names", "LifeStatus"],
            "Kakek/Nenek dari Ayah": ["names", "LifeStatus"],
            "Anak Kandung": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "feducationLevels", "fjob", "gender", "insuranceenoo", "childStatus", "freligion", "fnationality", "bpjshealths"],
            "Mertua": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "fdomicile", "feducationLevels", "fjob"],
            "Ayah": ["names", "LifeStatus", "niks", "BirthPlaces", "BirthDates", "fphone", "fdomicile", "feducationLevels", "fjob"]
        };

        function updateFamFormFields(selectedFamilyType) {
            const fieldsToShow = familyTypeFields[selectedFamilyType] || [];

            // Sembunyikan semua dulu
            $('.fam-field').hide();

            // Tampilkan yang sesuai
            fieldsToShow.forEach(field => {
                console.log("field: ", field);
                $(`.${field}-field`).show();
            });
        }

        $('#familytypes').on('change', function () {
            const selectedType = $(this).val();
            updateFamFormFields(selectedType);
        });

        const editFamilyTypeFields = {
            "Anak Tiri": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efeducationLevels", "efjob", "insurancenumber", "childStatus", "efreligion", "gender", "efnationality", "bpjshealth"],
            "Kakek Dari Ibu": ["name", "efLifeStatus"],
            "Nenek Dari Ibu": ["name", "efLifeStatus"],
            "Ibu": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efdomicile", "efeducationLevels", "efjob"],
            "Anak Angkat": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efeducationLevels", "efjob", "gender", "insurancenumber", "childStatus", "efreligion", "efnationality", "bpjshealth"],
            "Saudara": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efdomicile", "efeducationLevels", "efjob", "gender"],
            "Suami / Istri": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efdomicile", "efeducationLevels", "efjob", "gender", "insurancenumber", "efreligion", "efnationality", "bpjshealth", "addressStatus", , "efresidentialStatus"],
            "Kakek Dari Ayah": ["name", "efLifeStatus"],
            "Nenek Dari Ayah": ["name", "efLifeStatus"],
            "Kakek/Nenek dari Ibu": ["name", "efLifeStatus"],
            "Kakek/Nenek dari Ayah": ["name", "efLifeStatus"],
            "Anak Kandung": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efeducationLevels", "efjob", "gender", "insurancenumber", "childStatus", "efreligion", "efnationality", "bpjshealth"],
            "Mertua": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efdomicile", "efeducationLevels", "efjob"],
            "Ayah": ["name", "efLifeStatus", "eniks", "BirthPlace", "BirthDate", "efphone", "efdomicile", "efeducationLevels", "efjob"]
        };

        function updateEditFamFormFields(selectedFamilyType) {
            const fieldsToShow = editFamilyTypeFields[selectedFamilyType] || [];

            // Sembunyikan semua dulu
            $('.fam-field').hide();

            // Tampilkan yang sesuai
            fieldsToShow.forEach(field => {
                console.log("field: ", field);
                $(`.${field}-field`).show();
            });
        }

        $('#familytype').on('change', function () {
            const selectedType = $(this).val();
            updateEditFamFormFields(selectedType);
        });
    </script>
 }

@section styles{
    <link rel="stylesheet" type="text/css" href="~/plugins/bootstrap-suggest/bootstrap-suggest.css" />
}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" defer></script>
<link href="https://kendo.cdn.telerik.com/2024.1.130/styles/kendo.default-v2.min.css" rel="stylesheet" />


<style>
    .select2-container .select2-selection--single {
        height: 38px !important; /* Match Bootstrap form-control height */
        border: 1px solid #ced4da !important; /* Match Bootstrap border */
        border-radius: 4px !important; /* Rounded corners */
        padding: 6px 6px !important; /* Inner spacing */
    }

    .select2-container .select2-selection--single .select2-selection__rendered {
        line-height: 24px !important; /* Align text properly */
        font-size: 16px !important; /* Match form-control font size */
        color: #495057 !important; /* Bootstrap text color */
    }

    .select2-container .select2-selection--single .select2-selection__arrow {
        height: 38px !important; /* Match input height */
        top: 50% !important; /* Center arrow */
        transform: translateY(-50%) !important;
    }

    input[type="text"]:disabled, input[type="date"]:disabled, textarea:disabled {
        background-color: #f0ecec !important; /* Light gray background */
        border: 1px solid #ddd !important; /* Light border */
        opacity: 1 !important; /* Prevents the input from looking too faded */
    }

    .btn-close {
        display: inline-block;
        width: 1.8em; /* Increase size */
        height: 1.8em; /* Increase size */
        background: transparent url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><path fill='white' d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/></svg>") center/1.8em auto no-repeat;
        opacity: 1; /* Make sure it is fully visible */
    }

    .btn-close:hover {
        opacity: 0.8; /* Add a slight hover effect */
    }

    .fam-field{
        display: none;
    }

    

</style>


<div class="row">

    @* @*Preload image to avoid glitch
    <script type="text/javascript">
        // $(document).ready(function () {
        //     function preload_image(im_url) {
        //         let img = new Image();
        //         img.src = im_url;

        //         console.log("WORK");
        //     }

        //     if (photo != null)
        //     {
        //         console.log(ProfileData.NoReg);

        //         preload_image(Url.Content("~/api/employe-profile/download/${ProfileData.NoReg}");
        //     }
        //     else
        //     {
        //         preload_image(ConfigService.ResolveAvatar(ProfileData.NoReg));
        //     }
        // });

        $(document).ready(function () {
            function preload_image(im_url) {
                let img = new Image();
                img.src = im_url;
                console.log("Image preloaded:", im_url);
            }

            var ProfileData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ProfileData));
            var photo = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(photo));
    
            // Dapatkan avatar URL dari server dan kirim ke client
            var avatarUrl = '@ConfigService.ResolveAvatar(ProfileData.NoReg)';
    
            console.log('ProfileData:', ProfileData);

            if (photo != null) {
                var photoUrl = '@Url.Content("~/api/employe-profile/download/")' + ProfileData.NoReg;
                console.log("Loading photo:", photoUrl);
                preload_image(photoUrl);
            } else {
                console.log("Loading avatar:", avatarUrl);
                preload_image(avatarUrl);
            }
        });
    
    </script> *@

    @*main information*@
    <div class="col-md-4">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="row">

                            <button type="button" style="background: none; border: none; padding: 0; margin-left: 90%;" onclick="mainprofileModal()" @(isTerminated ? "disabled" : "")>
                                <i class="fa fa-pencil" style="color:#007bff;"></i>
                            </button>

                            <div class="col-sm-12 text-center d-flex align-items-center">

                                @if (ProfileData != null && !string.IsNullOrEmpty(ProfileData.NoReg))
                                {
                                    
                                    if (photo != null)
                                    {
                                        <form class="center-image d-flex form-photo" method="post" enctype="multipart/form-data" class="addphoto">
                                            <img style="display: none;" alt="Profile Picture" class="photo" src="@Url.Content($"~/api/employe-profile/download/{ProfileData.NoReg}")">
                                            <input type="file" name="photo" accept=".jpg, .jpeg, .png" style="display: none;" id="fileInput">
                                            <label class="add-photo" for="fileInput" style="display: none;"><i class="fa fa-plus-circle"></i></label>
                                        </form>
                                    }
                                    else
                                    {
                                        <form class="center-image d-flex form-photo" method="post" enctype="multipart/form-data" class="addphoto">
                                            <img style="display: none;" alt="Profile Picture" class="photo" src="@ConfigService.ResolveAvatar(ProfileData.NoReg)">
                                            <input type="file" name="photo" accept=".jpg, .jpeg, .png" style="display: none;" id="fileInput">
                                            <label class="add-photo" for="fileInput" style="display: none;"><i class="fa fa-plus-circle"></i></label>
                                        </form>
                                    }
                                    
                                        
                                }
                                else
                                {
                                    <i class="fas fa-user-circle" style="font-size: 7rem;"></i>
                                }
                            </div>
                            <div class="col-sm-12" style="margin-top:30px;">
                                <h5 class='font-weight-bold' style="text-align:center;">@ProfileData?.Name</h5>
                                <div class="row left-side" style="margin-top:30px;">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-pencil-square-o"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["No Reg"]</label>
                                                <p class='font-weight-bold'>@(ProfileData?.NoReg ?? "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row left-side">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-clipboard"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["Class"]</label>
                                                <p class='font-weight-bold'>@(ProfileData?.EmployeeSubgroupText ?? "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row left-side">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-calendar-o"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["Entry Date TAM"]</label>
                                                <p class='font-weight-bold'>@(PersonalData?[0]?.TamDate != null ? PersonalData[0].TamDate.ToString("dd/MM/yyyy") : "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @if (showAstra)
                                {
                                <div class="row left-side">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-industry"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["Entry Date ASTRA"]</label>
                                                <p class='font-weight-bold'>@(PersonalData?[0]?.EntryDate != null ? PersonalData[0].EntryDate.ToString("dd/MM/yyyy") : "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                }
                                <div class="row left-side">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-university"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["Work Location"]</label>
                                                <p class='font-weight-bold'>@(PersonalData?[0]?.EmployeeSubGroupText ?? "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row left-side">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-tag"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["Employee Category"]</label>
                                                <p class='font-weight-bold'>@(ViewData["Expr1"]?.ToString() ?? "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row left-side">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-2 icon-size">
                                                <i class="fa fa-user"></i>
                                            </div>
                                            <div class="col-sm-10">
                                                <label>@Localizer["Employee Status"]</label>
                                                <p class='font-weight-bold'>@(contract ?? "-")</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            var $photo = $('.photo');
            // $photo.hide(); // Sembunyikan gambar segera

            function load_image(im_url) {
                let img = new Image();
                img.onload = function() {
                    $photo.attr('src', im_url).fadeIn(100); // Munculkan perlahan ketika gambar selesai dimuat
                };
                img.src = im_url;

                $(".add-photo").show();
            }

            var ProfileData = @Html.Encode(Newtonsoft.Json.JsonConvert.SerializeObject(ProfileData));

            @* Handle URL foto di server-side *@
            @{
                var photoUrl = photo != null
                        ? Url.Content($"~/api/employe-profile/download/{ProfileData.NoReg}")
                        : ConfigService.ResolveAvatar(ProfileData.NoReg);
            }
            var photoUrl = "@photoUrl"; // Hasil dari pemrosesan server

            load_image(photoUrl);
        });
    </script>
    
    @*trigger to popup the modal of edit main information*@
    <script type="text/javascript">
        // Ensure the function is defined after the document is ready
        $(document).ready(function () {
            // Function to open the modal for editing
            window.mainprofileModal = function () {
                // Open the modal
                $('#mainProfileView').modal('show');
            };
        });
    </script>

    @*modal edit main information*@
	<div class="modal fade" id="mainProfileView" tabindex="-1" aria-hidden="true" role="dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="educationModalLabel">Edit Main Information</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="editmainProfile">
						<div class="card-content">
							<div class="card-body">
								<div class="row">
									<!-- Left Column -->
									<div class="col-md-6 col-sm-12">

										<div class="form-group">
											<label class="form-label">Noreg</label>
											<input type="text" class="form-control" id="NoregMain" name="NoregMain" value="@ProfileData.NoReg" disabled required>
										</div>

										<div class="form-group">
											<span style="color: red;">*</span><label class="form-label">Entry Date TAM</label>
											@*<input type="date" class="form-control" id="entrydateMain" value="@PersonalData[0]?.TamDate.ToString("yyyy-MM-dd")" required>*@
                                            @(Html.Kendo().DatePicker()
                                                .Name("entrydateMain")
                                                .HtmlAttributes(new
                                                {
                                                    id = "entrydateMain",
                                                    @class = "form-control",
                                                    placeholder = "(dd/mm/yyyy)",
                                                    onkeydown = "return false;",
                                                    required = "required"
                                                })
                                                .Value(PersonalData[0]?.TamDate)
                                                .Format("dd/MM/yyyy")
                                                .Deferred()
                                                )
										</div>


										<!--workloc-->
										<div class="form-group">
											<span style="color: red;">*</span><label class="form-label">Working Location</label>
											<select class="form-control" id="workloc" name="workloc" disabled required>
												@foreach (var subgrupList in (IEnumerable<string>)ViewData["subgrupList"])
												{
													@if (subgrupList == ViewData["subgrup"]?.ToString())
													{
														<option value="@subgrupList" selected="selected">@subgrupList</option>
													}
													else
													{
														<option value="@subgrupList">@subgrupList</option>
													}
												}
											</select>
										</div>

										<div class="form-group">
											<label class="form-label">Employee Status</label>
											<input type="text" class="form-control" id="empstatus" name="empstatus" value="@contract" disabled>
										</div>

									</div>

									<!-- Right Column -->
									<div class="col-md-6 col-sm-12">

										<div class="form-group">
											<label class="form-label">Class</label>
											<input type="text" class="form-control" id="ClassMain" name="ClassMain" value="@ProfileData.EmployeeSubgroupText" disabled>
										</div>
										<div class="form-group">
											<label class="form-label">Entry Date ASTRA</label>
											@*<input type="date" class="form-control" id="astradates" value="@PersonalData[0]?.EntryDate.ToString("yyyy-MM-dd")" required>*@
                                            @(Html.Kendo().DatePicker()
                                                .Name("astradates")
                                                .HtmlAttributes(new
                                                {
                                                    id = "astradates",
                                                    @class = "form-control",
                                                    placeholder = "(dd/mm/yyyy)",
                                                    onkeydown = "return false;"
                                                })
                                                .Value(PersonalData[0]?.EntryDate)
                                                .Format("dd/MM/yyyy")
                                                .Deferred()
                                                )
										</div>

										<div class="form-group">
											<label class="form-label">Employee Category</label>
											<input type="text" class="form-control" id="exprs1" value="@ViewData["Expr1"]" disabled>
										</div>


									</div>
								</div>
							</div>
						</div>
					</form>
				</div>

				<!-- Modal Footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<button type="submit" id="savemainprofileButton" class="btn btn-primary">Save</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener("DOMContentLoaded", function () {
		    document.getElementById("savemainprofileButton").addEventListener("click", function () {
				app.confirm("@Localizer["Are you sure you want to update main profile?"]", function (d) {
					if (!d.value) return;

                    // Collect form data
				    var profilesData = {
					    Noreg: $('#NoregMain').val(),
                        EntryDate: $('#entrydateMain').data("kendoDatePicker").value() ?
                            kendo.toString($('#entrydateMain').data("kendoDatePicker").value(), "yyyy-MM-dd") : null,
					    WorkLocation: $('#workloc').val(),
                        AstraDate: $('#astradates').data("kendoDatePicker").value() ?
                            kendo.toString($('#astradates').data("kendoDatePicker").value(), "yyyy-MM-dd") : null,

				    };

				    // API URL (Ensure it's correct for your server routing)
				    var url = '@Url.Content("~/api/employe-profile/updateprofilemain")';

					// Call the API
					$.ajax({
						url: url,
						type: 'POST',
						contentType: 'application/json',
						   data: JSON.stringify(profilesData),
						success: function (response) {
							app.success("@Localizer["Profile details updated successfully."]", "");
							location.reload();
						},
						error: function (xhr, status, error) {
							app.error("@Localizer["Failed to update profile details."]", "");
						}
					});
				});
			});
		});
	</script>

	<div class="col-md-8">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="tab">
                            <button class="tablinks active" onclick="openCity(event, 'PersonalData')">@Localizer["Personal Data"]</button>
                            <button class="tablinks" onclick="openCity(event, 'OA')">@Localizer["Organization Assignment"]</button>
                            <button class="tablinks" onclick="openCity(event, 'Education')">@Localizer["Education"]</button>
                            <button class="tablinks" onclick="openCity(event, 'Family')">@Localizer["Family Member"]</button>
                            <button class="tablinks" onclick="openCity(event, 'EC')">@Localizer["Emergency Contact"]</button>
                            <button class="tablinks" onclick="openCity(event, 'TE')">@Localizer["Training & Event"]</button>
                            <button class="tablinks" onclick="openCity(event, 'MH')">@Localizer["Medical History"]</button>
                            <button class="tablinks" onclick="openCity(event, 'PD')">@Localizer["Personal Development"]</button>
                            <button class="tablinks" onclick="openCity(event, 'HBC')">@Localizer["History Benefit Claim"]</button>
                        </div>

                        <div id="PersonalData" class="tabcontent" style="display: block; padding-top: 0px">
                            <!-- <br /> -->

                            <div class="card-body" style="padding-top: 0px">

                                @* @(
                                    Html.Kendo().Grid<PersonalDataAllProfileStoredEntity>(ListProfileData)
                                    .Name("personaldataGrid")
                                    .HtmlAttributes(new { @class = "not-hoverable table-fixed-header", @style = "font-size:0.8rem" })
                                    .Columns(columns =>
                                    {
                                        columns.Bound(c => c.NoReg).Title("No Reg");
                                        columns.Bound(c => c.Name).Title("Name");
                                        columns.Bound(c => c.Gender).Title("Gender");
                                    })
                                    .DataSource(dataSource => 
                                        dataSource
                                        .Ajax()
                                        .Read(read => read.Url(Url.Content("~/api/personaldata/get")))
                                    )
                                ) *@

                                <br />  

                                <form id="editProfileForm" method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="NoReg" value="@ViewData["NoReg"]" />
                                    <style>
                                        .error-border {
                                            border: 2px solid red !important;
                                        }
                                    </style>

                                    <div class="row">
                                        <!-- Left Side -->
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <span style="color: red; display: none" id="asterisk-name" class="mandatory-asterisk">* </span><label for="profileData">Full Name Without Title</label>
                                                <input type="text" class="form-control" id="namess" name="namess" value="@ViewData["NameUser"]?.ToString()" disabled required/>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wni">* </span><label for="profileData">Passport Number</label>
                                                <input type="text" class="form-control non-mandatory-input-wni" id="passport" name="passport" value="@ViewData["passportNumber"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="phone">Phone Number</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <select class="form-control" id="phoneCode" name="phoneCode" style="max-width: 100px;" disabled>
                                                            @{
                                                                var selectedCode = ViewData["selectedPhoneCode"]?.ToString() ?? "+62";
                                                                var phoneNumber = ViewData["phoneNum"]?.ToString();
                                                                var phoneList = ViewData["phoneList"] as List<string>;
                                                            }
                                                            @foreach (var code in phoneList)
                                                            {
                                                                <option value="@code" selected="@(code == selectedCode ? "selected" : null)">@code</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <input type="text" class="form-control phone-number" id="phone" name="phone" value="@phoneNumber" disabled />
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="pob">Place of Birth</label>
                                                <select class="form-control" id="pob" name="Pob" data-default-value="@ViewData["pob"]" disabled>
                                                    <option value="">Please select Place of Birth</option>
                                                    @{
                                                        var selectedPob = ViewData["pob"] as string;
                                                    }

                                                    @foreach (var pob in (IEnumerable<string>)ViewData["pobList"] ?? new List<string>())
                                                    {
                                                        <option value="@pob" selected="@(string.Equals(pob, selectedPob, StringComparison.OrdinalIgnoreCase) ? "selected" : null)">
                                                            @pob
                                                        </option>
                                                    }
                                                </select>
                                            </div>


                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="dob">Date of Birth</label>
                                                @*<input type="date" class="form-control" id="dob" name="dob" value="@ViewData["dob"]" disabled required/>*@
                                                @(Html.Kendo().DatePicker()
                                                    .Name("dob")
                                                    .HtmlAttributes(new
                                                    {
                                                        id = "dob", // Tambahkan ini
                                                        @class = "form-control",
                                                        placeholder = "(dd/mm/yyyy)",
                                                        onkeydown = "return false;"
                                                    })
                                                    .Value(ViewData["dob"] != null ? Convert.ToDateTime(ViewData["dob"]) : DateTime.Today)
                                                    .Format("dd/MM/yyyy")
                                                    .Enable(false)
                                                    .Deferred()
                                                    )
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="gender">Gender</label>
                                                <select class="form-control" id="genderss" name="genderss" disabled>
                                                    @if (string.IsNullOrEmpty(Convert.ToString(ViewData["gender"])))
                                                    {
                                                        <option value="" selected="selected"></option>
                                                    }

                                                    @if (ViewData["gender"]?.ToString() == "Laki - Laki")
                                                    {
                                                        <option value="lakilaki" selected="selected">Male</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="lakilaki">Male</option>
                                                    }

                                                    @if (ViewData["gender"]?.ToString() == "Perempuan")
                                                    {
                                                        <option value="perempuan" selected="selected">Female</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="perempuan">Female</option>
                                                    }
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="email">Email</label>
                                                <input type="text" class="form-control" id="email" name="Email" value="@ViewData["Email"]?.ToString()" disabled />
                                            </div>

                                            @*<div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="address">KTP Address</label>
                                                <input type="text" class="form-control" id="address" name="Address" value="@ViewData["Address"]?.ToString()" disabled required/>
                                            </div>*@

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="address">KTP Address</label>
                                                <textarea class="form-control" id="address" name="Address" onclick="openAddressForm()" disabled style="resize: none; height: 85px">@ViewData["Addresss"]?.ToString()</textarea>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="status">Marital Status</label>
                                                <select class="form-control" id="status" name="Status" data-default-value="@ViewData["MartalStatus"]" disabled>
                                                    @{
                                                        var selectedValue = ViewData["MartalStatus"];
                                                    }

                                                    @foreach (var maritalStatus in (IEnumerable<string>)ViewData["maritalStatus"])
                                                    {
                                                        <option value="@maritalStatus" selected="@(maritalStatus == selectedValue.ToString() ? "selected" : null)">
                                                            @maritalStatus
                                                        </option>
                                                    }
                                                </select>
                                            </div>

                                            <div class="form-group" id="marriedCertField">
                                                <span style="color: red; display: none">* </span><label for="personalData">Marital Certificate Number</label>
                                                <input type="text" class="form-control" id="marCerNum" name="marCelNum" value="@Html.Encode(ViewData["marCerti"])" disabled />
                                            </div>

                                            <div class="form-group" id="divorceCertField">
                                                <span style="color: red; display: none">* </span><label for="personalData">Divorce Certificate Number</label>
                                                <input type="text" class="form-control" id="divCerNum" name="divCerNum" value="@Html.Encode(ViewData["divCerti"])" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="personalData">Account Number</label>
                                                <input type="text" class="form-control strict-an non-mandatory-input-wna" id="accountnumber" name="accountnumber" value="@ViewData["accountNumber"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="personalData">Account Name</label>
                                                <input type="text" class="form-control non-mandatory-input-wna" id="accountname" name="accountname" value="@ViewData["accountName"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="personalData">BPJS Employment Number</label>
                                                <input type="text" class="form-control non-mandatory-input-wna" id="ben" name="Ben" value="@ViewData["bpjsen"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="personalData">Dana Pensiun Number</label>
                                                <input type="text" class="form-control strict-ndp non-mandatory-input-wna" id="ndp" name="ndp" value="@ViewData["np"]" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="">* </span><label for="personalData">SIM A Number</label>
                                                <input type="text" class="form-control" id="simanumber" name="simanumber" value="@ViewData["simaNumber"]?.ToString()" disabled/>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="bg">Blood Group</label>
                                                <select class="form-control non-mandatory-input-wna" id="bg" name="Bg" data-default-value="@ViewData["bg"]?.ToString()" disabled>
                                                <option value="" disabled selected>Please select Blood Group</option>
                                                    @foreach (var bloodList in (IEnumerable<string>)ViewData["bloodList"])
                                                    {
                                                        @if (bloodList == ViewData["bg"]?.ToString())
                                                        {
                                                            <option value="@bloodList" selected="selected">@bloodList</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@bloodList">@bloodList</option>
                                                        }
                                                    }
                                                </select>
                                            </div>

                                        </div>


                                      <!-- Right Side -->
                                        <div class="col-md-6">

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="profileData">Identity Card / KTP Name</label>
                                                <input type="text" class="form-control" id="identityName" name="identityName" value="@ViewData["identityName"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="nationality">Nationality</label>
                                                <select class="form-control" id="nationality" name="nationality" data-default-value="@ViewData["Nationality"]?.ToString()" disabled>
                                                <option value="" disabled selected>Please select Nationality</option>
                                                    @foreach (var nationality in (IEnumerable<string>)ViewData["NationalityList"])
                                                    {
                                                        @if (!string.IsNullOrEmpty(ViewData["Nationality"]?.ToString()) && nationality.Contains(ViewData["Nationality"].ToString()))
                                                        {
                                                            <option value="@nationality" selected="selected">@nationality</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@nationality">@nationality</option>
                                                        }
                                                    }
                                                </select>
                                            </div>

                                            <input type="text" class="form-control" id="noreg" name="Noreg" value="@ViewData["noregs"]" disabled hidden/>
                                         
                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="wanum">Whatsapp Number</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <select class="form-control" id="waCode" name="waCode" style="max-width: 100px;" disabled>
                                                            @{
                                                                var selectedWaCode = ViewData["selectedWaCode"]?.ToString() ?? "+62";
                                                                var waNumber = ViewData["waNum"]?.ToString();
                                                            }
                                                            @foreach (var code in phoneList)
                                                            {
                                                                <option value="@code" selected="@(code == selectedWaCode ? "selected" : null)">@code</option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <input type="text" class="form-control phone-number" id="wanum" name="wanum" value="@waNumber" disabled />
                                                </div>
                                            </div>
                                          
                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="personalData">Identity Number / KTP Number</label>
                                                <input type="text" class="form-control strict-number" id="idn" name="idn" value="@ViewData["idNumber"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="personalData">Family Card Number</label>
                                                <input type="text" class="form-control strict-number non-mandatory-input-wna" id="kk" name="kk" value="@ViewData["kk"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="education">NPWP</label>
                                                <input type="text" oninput="validateNumberInput(this)" class="form-control" id="npwp" name="npwp" value="@ViewData["npwp"]?.ToString()" disabled />
                                            </div>
                                          
                                            <div class="form-group">
                                                <span style="color: red; display: none" class="">* </span><label for="profileData">Personal Email</label>
                                                <input type="text" class="form-control" id="personalEmail" name="personalEmail" value="@ViewData["personalemail"]?.ToString()" disabled />
                                            </div>

                                            @*<div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="domicile">Domicile Address</label>
                                                <input type="text" class="form-control" id="domicile" name="domicile" value="@ViewData["domicile"]?.ToString()" disabled required/>
                                            </div>*@
                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="domicile">Domicile Address</label>
                                                <textarea class="form-control" id="domicile" name="domicile" onclick="openDomicileForm()" disabled style="resize: none; height: 85px;">@Html.Encode(ViewData["domicile"])</textarea>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="religion">Religion</label>
                                                <select class="form-control" id="religion" name="Religion" data-default-value="@ViewData["Religion"]?.ToString()" disabled>
                                                <option value="" disabled selected>Please select Religion</option>
                                                    @foreach (var religionList in (IEnumerable<string>)ViewData["religionList"])
                                                    {
                                                        @if (!string.IsNullOrEmpty(religionList) && !string.IsNullOrEmpty(ViewData["Religion"]?.ToString()) && religionList.Contains(ViewData["Religion"].ToString()))
                                                        {
                                                            <option value="@religionList" selected="selected">@religionList</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@religionList">@religionList</option>
                                                        }
                                                    }
                                                </select>
                                            </div>

                                            <div class="form-group" id="marriedDateField">
                                                <span style="color: red; display: none" class="mandatory-asterisk">*</span><label class="form-label">Married Date</label>
                                                @*<input type="date" class="form-control" id="maritalDate" disabled value="@ViewData["marDate"]">*@
                                                @{
                                                    DateTime? marDate = null;

                                                    if (ViewData["marDate"] is DateTime dt)
                                                    {
                                                        marDate = dt;
                                                    }
                                                    else if (ViewData["marDate"] is string marDateStr && DateTime.TryParse(marDateStr, out DateTime parsed))
                                                    {
                                                        marDate = parsed;
                                                    }
                                                }

                                                @(Html.Kendo().DatePicker()
                                                 .Name("maritalDate")
                                                 .HtmlAttributes(new
                                                 {
                                                     id = "maritalDate",
                                                     @class = "form-control custom-datepicker"
                                                 })
                                                 .Value(marDate)
                                                 .Format("dd/MM/yyyy")
                                                 .Enable(false)
                                                 .Deferred()
                                                 )
                                            </div>

                                            <div class="form-group" id="divorceDateField">
                                                <span style="color: red; display: none" class="mandatory-asterisk">*</span><label class="form-label">Divorce Date</label>
                                                @*<input type="date" class="form-control" id="divorceDate" disabled value="@ViewData["divDate"]">*@
                                                @{
                                                    DateTime? divDate = null;

                                                    if (ViewData["divDate"] is DateTime dts)
                                                    {
                                                        divDate = dts;
                                                    }
                                                    else if (ViewData["divDate"] is string divDateStr && DateTime.TryParse(divDateStr, out DateTime parsed))
                                                    {
                                                        divDate = parsed;
                                                    }
                                                }

                                                @(Html.Kendo().DatePicker()
                                                                                                .Name("divorceDate")
                                                                                                .HtmlAttributes(new
                                                                                                {
                                                                                                    id = "divorceDate",
                                                                                                    @class = "form-control",
                                                                                                    disabled = "disabled"
                                                                                                })
                                                                                                .Value(divDate)
                                                                                                .Format("dd/MM/yyyy")
                                                                                                .Enable(false)
                                                                                                .Deferred()
                                                                                                )
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk non-mandatory-wna">* </span><label for="branch">Branch (Bank)</label>
                                                <select class="form-control non-mandatory-input-wna" id="branch" name="branch" data-default-value="@ViewData["bankSelect"]?.ToString()" disabled>
                                                    <option value="" disabled selected>Please select Bank</option>
                                                    @foreach (var bankList in (IEnumerable<string>)ViewData["bankList"])
                                                    {
                                                        @if (!string.IsNullOrEmpty(ViewData["bankSelect"]?.ToString()) && bankList.Contains(ViewData["bankSelect"].ToString()))
                                                        {
                                                            <option value="@bankList" selected="selected">@bankList</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@bankList">@bankList</option>
                                                        }
                                                    }
                                                </select>
                                            </div>


                                          @*   <div class="form-group">
                                                <label for="personalData">Tax Status</label>
                                                <input type="text" class="form-control" id="ts" name="Ts" value="@ViewData["taxStatus"]?.ToString()" disabled/>
                                            </div>
                                          *@
                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="taxStatus">Tax Status</label>
                                                <select class="form-control" id="ts" name="Ts" data-default-value="@ViewData["taxSelect"]?.ToString()" disabled>
                                                
                                                    @foreach (var taxList in (IEnumerable<string>)ViewData["taxList"])
                                                    {
                                                        @if (!string.IsNullOrEmpty(ViewData["taxSelect"]?.ToString()) && taxList == ViewData["taxSelect"].ToString())
                                                        {
                                                            <option value="@taxList" selected="selected">@taxList</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@taxList">@taxList</option>
                                                        }
                                                    }
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="familyMember">BPJS Health Number</label>
                                                <input type="text" class="form-control strict-bpjs" id="bpjs" name="bpjs" value="@ViewData["bpjs"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="">* </span><label for="personalData">Insurance Number</label>
                                                <input type="text" class="form-control number-hyphen-only " id="insuranceno" name="insuranceNo" value="@ViewData["insuranceNo"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="">* </span><label for="personalData">SIM C Number</label>
                                                <input type="text" class="form-control" id="simcnumber" name="simcnumber" value="@ViewData["simcNumber"]?.ToString()" disabled/>
                                            </div>

                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary" id="editProfileButton" style="float:right; margin-right:20px;" @(isTerminated ? "disabled" : "")>
                                        <i class="fa fa-pencil"></i> Edit Profile
                                    </button>
                                    
                                    <button type="button" class="btn btn-danger" id="cancelsaveButton" hidden style="float:right; margin-left:10px; bottom:0px;">Cancel</button>

                                    <button type="submit" class="btn btn-primary" id="saveprofileButton" hidden style="float:right; bottom:0px;">Save</button>
                                    
                                    <br />

                                </form>

                            </div>
                            <div class="col-sm-12">
                                <div class="p-0 table-responsive">
                                    
                                </div>
                            </div>
                        </div>

                        <div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="addressModalLabel">Address Form</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="addressForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="addressProvince" class="form-label">Province</label>
                                                    @*<input type="text" class="form-control" id="addressProvince" name="addressProvince" required>*@
                                                    <select class="form-control" id="addressProvince" name="addressProvince" data-default-value="@Html.Encode(ViewData["adrProvince"])">
                                                    <option value="" disabled selected>Please select Region</option>
                                                        @foreach (var region in (IEnumerable<string>)ViewData["RegionList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["adrProvince"]?.ToString()) && region.Contains(ViewData["adrProvince"].ToString()))
                                                            {
                                                                <option value="@region" selected="selected">@region</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@region">@region</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="addressDistrict" class="form-label">Town/District</label>
                                                    @*<input type="text" class="form-control" id="addressDistrict" name="addressDistrict" required>*@
                                                    <select class="form-control" id="addressDistrict" name="addressDistrict" data-default-value="@Html.Encode(ViewData["adrDistrict"])">
                                                    <option value="" disabled selected>Please select District</option>
                                                        @foreach (var district in (IEnumerable<string>)ViewData["DistrictList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["adrDistrict"]?.ToString()) && district.Contains(ViewData["adrDistrict"].ToString()))
                                                            {
                                                                <option value="@district" selected="selected">@district</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@district">@district</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="addressSubDistrict" class="form-label">Sub - District</label>
                                                    @*<input type="text" class="form-control" id="addressSubDistrict" name="addressSubDistrict" required>*@
                                                    <select class="form-control" id="addressSubDistrict" name="addressSubDistrict" data-default-value="@Html.Encode(ViewData["adrSubDistrict"])">
                                                    <option value="" disabled selected>Please select Sub-District</option>
                                                        @foreach (var subdistrict in (IEnumerable<string>)ViewData["SubDistrictList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["adrSubDistrict"]?.ToString()) && subdistrict.Contains(ViewData["adrSubDistrict"].ToString()))
                                                            {
                                                                <option value="@subdistrict" selected="selected">@subdistrict</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@subdistrict">@subdistrict</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="addressAdmVillage" class="form-label">Administrative Village</label>
                                                    @*<input type="text" class="form-control" id="addressAdmVillage" name="addressAdmVillage" required>*@
                                                    <select class="form-control" id="addressAdmVillage" name="addressAdmVillage" data-default-value="@Html.Encode(ViewData["adrAdmVillage"])">
                                                        @{
                                                            var adrAdmVillage = Html.Encode(ViewData["adrAdmVillage"]);
                                                        }

                                                        @if (!string.IsNullOrEmpty(adrAdmVillage))
                                                        {
                                                            <option value="@adrAdmVillage">@adrAdmVillage</option>
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="addressPCode" class="form-label">Postal Code</label>
                                                    @*<input type="text" class="form-control" id="addressPCode" name="addressPCode" required>*@
                                                    <select class="form-control" id="addressPCode" name="addressPCode" data-default-value="@Html.Encode(ViewData["adrPostalCode"])">
                                                        <option value="" disabled selected>Please select Postal Code</option>
                                                        @foreach (var postCode in (IEnumerable<string>)ViewData["AdrPostCodeList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["adrPostalCode"]?.ToString()) && postCode.Contains(ViewData["adrPostalCode"].ToString()))
                                                            {
                                                                <option value="@postCode" selected="selected">@postCode</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@postCode">@postCode</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label for="addressRt" class="form-label">RT</label>
                                                    <input type="text" class="form-control" id="addressRt" name="addressRt" value="@Html.Encode(ViewData["adrRt"])">
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label for="addressRw" class="form-label">RW</label>
                                                    <input type="text" class="form-control" id="addressRw" name="addressRw" value="@Html.Encode(ViewData["adrRw"])">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="addressAddress" class="form-label">Address</label>
                                                <input type="text" class="form-control" id="addressAddress" name="addressAddress" value="@Html.Encode(ViewData["address"])">
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="addressResidential" class="form-label">Residential Status</label>
                                                    @*<input type="text" class="form-control" id="addressResidential" name="addressResidential" required>*@
                                                    <select class="form-control" id="addressResidential" name="addressResidential" data-default-value="@ViewData["adrResidential"]">
                                                        <option value="" disabled selected>Please select Residential Status</option>
                                                        @foreach (var residentStatus in (IEnumerable<string>)ViewData["AdrResidentialStatus"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["adrResidential"]?.ToString()) && residentStatus.Contains(ViewData["adrResidential"].ToString()))
                                                            {
                                                                <option value="@residentStatus" selected="selected">@residentStatus</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@residentStatus">@residentStatus</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                @*<div class="col-md-6 mb-3">
                                                    <label for="addressTotFamily" class="form-label">Total Family</label><span style="color: red;"> *</span>
                                                    <input type="text" class="form-control" id="addressTotFamily" name="addressTotFamily" required>
                                                </div>*@
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-warning" onclick="clearAddressForm()">Clear</button>
                                        <button type="button" class="btn btn-primary" onclick="saveAddress()">Save Address</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            function clearAddressForm() {
                                const form = document.getElementById("addressForm");
                        
                                form.querySelectorAll("input[type='text']").forEach(input => input.value = "");
                        
                                form.querySelectorAll("select").forEach(select => {
                                    select.selectedIndex = 0;
                                });
                            }
                        </script>

                        <script>
                            $(document).ready(function () {
                                $('#addressModal').on('shown.bs.modal', function () {
                                    $('#addressAdmVillage').select2({
                                        dropdownParent: $('#addressModal'),
                                        placeholder: 'Search Administrative Village...',
                                        minimumInputLength: 3,
                                        ajax: {
                                            url: '/Reporting/EmployeeProfile/SearchAdmVillage', // Ganti sesuai route
                                            dataType: 'json',
                                            delay: 250,
                                            data: function (params) {
                                                return { term: params.term };
                                            },
                                            processResults: function (data) {
                                                return { results: data }; // expects [{id: 'xx', text: 'xx'}]
                                            },
                                            cache: true
                                        },
                                        width: '100%'
                                    });

                                    $('#addressProvince, #addressDistrict, #addressSubDistrict, #addressPCode, #addressResidential').select2({
                                        dropdownParent: $('#addressModal'),
                                        width: '100%'
                                    });
                                });
                            });
                        </script>

                        <script>
                            let addressModal;

                            document.addEventListener('DOMContentLoaded', function () {
                                addressModal = new bootstrap.Modal(document.getElementById('addressModal'));
                            });

                            function resetAddressForm() {
                                const form = document.getElementById('addressForm');
                                if (!form) return;

                                // Loop all form elements
                                Array.from(form.elements).forEach(el => {
                                    const defaultValue = el.getAttribute('data-default-value');
                                    if (defaultValue !== null) {
                                        el.value = defaultValue;
                                    } else {
                                        el.value = ''; // if not set, fallback
                                    }
                                });
                            }

                            function openAddressForm() {
                                addressModal.show();
                            }

                            function saveAddress() {
                                const form = document.getElementById('addressForm');
                                const formData = new FormData(form);

                                // Validate required fields
                                // const requiredFields = ['addressProvince', 'addressDistrict', 'addressSubDistrict', 'addressAdmVillage', 'addressPCode', 'addressRt', 'addressRw', 'addressAddress', 'addressResidential'];
                                // let isValid = true;

                                // requiredFields.forEach(field => {
                                //     const element = document.getElementById(field);
                                //     if (!element.value.trim()) {
                                //         element.classList.add('is-invalid');
                                //         isValid = false;
                                //     } else {
                                //         element.classList.remove('is-invalid');
                                //     }
                                // });

                                // if (!isValid) {
                                //     alert('Please fill in all required fields');
                                //     return;
                                // }

                                // Build complete address dari form fields
                                const province = document.getElementById('addressProvince').value;
                                const district = document.getElementById('addressDistrict').value;
                                const subDistrict = document.getElementById('addressSubDistrict').value;
                                const admVillage = document.getElementById('addressAdmVillage').value;
                                const postalCode = document.getElementById('addressPCode').value;
                                const rt = document.getElementById('addressRt').value;
                                const rw = document.getElementById('addressRw').value;
                                const address = document.getElementById('addressAddress').value;
                                const residential = document.getElementById('addressResidential').value;

                                // Format alamat lengkap
                                let completeAddress = '';
                                if (address) completeAddress += address;
                                if (rt) completeAddress += (completeAddress ? ', RT ' : 'RT ') + rt;
                                if (rw) completeAddress += (rw ? '/RW ' + rw : '');
                                if (admVillage) completeAddress += (completeAddress ? ', ' : '') + admVillage;
                                if (subDistrict) completeAddress += (completeAddress ? ', ' : '') + subDistrict;
                                if (district) completeAddress += (completeAddress ? ', ' : '') + district;
                                if (province) completeAddress += (completeAddress ? ', ' : '') + province;
                                if (postalCode) completeAddress += (completeAddress ? ' ' : '') + postalCode;

                                // Update textarea utama dengan alamat lengkap
                                document.getElementById('address').value = completeAddress;

                                // Close modal
                                addressModal.hide();

                                // Optional: Send data to server via AJAX
                                //console.log('Address saved:', Object.fromEntries(formData));
                            }

                            // Handle modal close event
                            document.getElementById('addressModal').addEventListener('hidden.bs.modal', function () {
                                // Clear form validation classes
                                const form = document.getElementById('addressForm');
                                const inputs = form.querySelectorAll('.form-control');
                                inputs.forEach(input => {
                                    input.classList.remove('is-invalid');
                                });
                            });
                        </script>

                        <div class="modal fade" id="domicileModal" tabindex="-1" aria-labelledby="domicileModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="domicileModalLabel">Domicile Address Form</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
                                    </div>
                                    <div class="modal-body">
                                        <div>
                                            <input type="checkbox" id="sameAsKTP" />
                                            <label for="sameAsKTP">Domicile address is the same as KTP address</label>
                                        </div>
                                        <form id="domicileForm">
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicileProvince" class="form-label">Province</label>
                                                    <select class="form-control" id="domicileProvince" name="domicileProvince" data-default-value="@Html.Encode(ViewData["domicileProvince"])">
                                                    <option value="" disabled selected>Please select Region</option>
                                                        @foreach (var region in (IEnumerable<string>)ViewData["RegionList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["domicileProvince"]?.ToString()) && region.Contains(ViewData["domicileProvince"].ToString()))
                                                            {
                                                                <option value="@region" selected="selected">@region</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@region">@region</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicileDistrict" class="form-label">Town/District</label>
                                                    <select class="form-control" id="domicileDistrict" name="domicileDistrict" data-default-value="@Html.Encode(ViewData["domicileDistrict"])">
                                                    <option value="" disabled selected>Please select District</option>
                                                        @foreach (var district in (IEnumerable<string>)ViewData["DistrictList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["domicileDistrict"]?.ToString()) && district.Contains(ViewData["domicileDistrict"].ToString()))
                                                            {
                                                                <option value="@district" selected="selected">@district</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@district">@district</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicileSubDistrict" class="form-label">Sub - District</label>
                                                    <select class="form-control" id="domicileSubDistrict" name="domicileSubDistrict" data-default-value="@Html.Encode(ViewData["domicileSubDistrict"])">
                                                    <option value="" disabled selected>Please select Sub-District</option>
                                                        @foreach (var subdistrict in (IEnumerable<string>)ViewData["SubDistrictList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["domicileSubDistrict"]?.ToString()) && subdistrict.Contains(ViewData["domicileSubDistrict"].ToString()))
                                                            {
                                                                <option value="@subdistrict" selected="selected">@subdistrict</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@subdistrict">@subdistrict</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicileAdmVillage" class="form-label">Administrative Village</label>
                                                    <select class="form-control" id="domicileAdmVillage" name="domicileAdmVillage" data-default-value="@Html.Encode(ViewData["domicileAdmVillage"])">
                                                        @{
                                                            var domicileAdmVillage = Html.Encode(ViewData["domicileAdmVillage"]);
                                                        }

                                                        @if (!string.IsNullOrEmpty(domicileAdmVillage))
                                                        {
                                                            <option value="@domicileAdmVillage">@domicileAdmVillage</option>
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicilePCode" class="form-label">Postal Code</label>
                                                    <select class="form-control" id="domicilePCode" name="domicilePCode" data-default-value="@Html.Encode(ViewData["domicilePostalCode"])">
                                                        <option value="" disabled selected>Please select Administration Village</option>
                                                        @foreach (var postCode in (IEnumerable<string>)ViewData["AdrPostCodeList"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["domicilePostalCode"]?.ToString()) && postCode.Contains(ViewData["domicilePostalCode"].ToString()))
                                                            {
                                                                <option value="@postCode" selected="selected">@postCode</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@postCode">@postCode</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label for="domicileRt" class="form-label">RT</label>
                                                    <input type="text" class="form-control" id="domicileRt" name="domicileRt" value="@Html.Encode(ViewData["domicileRt"])">
                                                </div>
                                                <div class="col-md-3 mb-3">
                                                    <label for="domicileRw" class="form-label">RW</label>
                                                    <input type="text" class="form-control" id="domicileRw" name="domicileRw" value="@Html.Encode(ViewData["domicileRw"])">
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label for="domicileAddress" class="form-label">Address</label>
                                                <input type="text" class="form-control" id="domicileAddress" name="domicileAddress" value="@ViewData["DomicileAddress"]?.ToString()" >
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicileResidential" class="form-label">Residential Status</label>
                                                    <select class="form-control" id="domicileResidential" name="domicileResidential" data-default-value="@ViewData["domicileResidential"]" >
                                                        <option value="" disabled selected>Please select Residential Status</option>
                                                        @foreach (var residentStatus in (IEnumerable<string>)ViewData["AdrResidentialStatus"])
                                                        {
                                                            @if (!string.IsNullOrEmpty(ViewData["domicileResidential"]?.ToString()) && residentStatus.Contains(ViewData["domicileResidential"].ToString()))
                                                            {
                                                                <option value="@residentStatus" selected="selected">@residentStatus</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@residentStatus">@residentStatus</option>
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="domicileTotalFamily" class="form-label">Total Family</label>
                                                    <input type="text" class="form-control" id="domicileTotalFamily" name="domicileTotalFamily" value="@Html.Encode(ViewData["domicileTotalFamily"])" >
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-warning" onclick="clearDAddressForm()">Clear</button>
                                        <button type="button" class="btn btn-primary" onclick="saveDomicile()">Save Address</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            function clearDAddressForm() {
                                const form = document.getElementById("domicileForm");

                                form.querySelectorAll("input[type='text']").forEach(input => input.value = "");

                                form.querySelectorAll("select").forEach(select => {
                                    select.selectedIndex = 0;
                                });
                            }
                        </script>

                        <script>
                            document.getElementById('sameAsKTP').addEventListener('change', function () {
                                if (this.checked) {
                                    Swal.fire({
                                        title: 'Are you sure?',
                                        text: 'Are you sure your Domicile Address is the same as your KTP address?',
                                        type: 'question',
                                        showCancelButton: true,
                                        confirmButtonText: 'Yes',
                                        cancelButtonText: 'No'
                                    }).then((result) => {
                                        if (result.value) {
                                            // Copy text inputs
                                            document.getElementById('domicileAddress').value = document.getElementById('addressAddress').value;
                                            document.getElementById('domicilePCode').value = document.getElementById('addressPCode').value;
                                            document.getElementById('domicileRt').value = document.getElementById('addressRt').value;
                                            document.getElementById('domicileRw').value = document.getElementById('addressRw').value;

                                            // Province
                                            document.getElementById('domicileProvince').value = document.getElementById('addressProvince').value;
                                            document.getElementById('domicileProvince').dispatchEvent(new Event('change'));

                                            setTimeout(() => {
                                                document.getElementById('domicileDistrict').value = document.getElementById('addressDistrict').value;
                                                document.getElementById('domicileDistrict').dispatchEvent(new Event('change'));

                                                // Sub District
                                                setTimeout(() => {
                                                    document.getElementById('domicileSubDistrict').value = document.getElementById('addressSubDistrict').value;
                                                    document.getElementById('domicileSubDistrict').dispatchEvent(new Event('change'));

                                                    // Administrative Village
                                                    setTimeout(() => {
                                                        document.getElementById('domicileAdmVillage').value = document.getElementById('addressAdmVillage').value;
                                                    }, 300);
                                                }, 300);
                                            }, 300);

                                            // Residential Status
                                            document.getElementById('domicileResidential').value = document.getElementById('addressResidential').value;

                                            Swal.fire({
                                                title: 'Success!',
                                                text: 'Address copied successfully!',
                                                type: 'success',
                                                timer: 2000,
                                                showConfirmButton: false
                                            });
                                        } else {
                                            this.checked = false;
                                        }
                                    });
                                }
                            });
                        </script>

                        <script>
                            $(document).ready(function () {
                                $('#domicileModal').on('shown.bs.modal', function () {
                                    $('#domicileAdmVillage').select2({
                                        dropdownParent: $('#domicileModal'),
                                        placeholder: 'Search Administrative Village...',
                                        minimumInputLength: 3,
                                        ajax: {
                                            url: '/Reporting/EmployeeProfile/SearchAdmVillage',
                                            dataType: 'json',
                                            delay: 250,
                                            data: function (params) {
                                                return { term: params.term };
                                            },
                                            processResults: function (data) {
                                                return { results: data };
                                            },
                                            cache: true
                                        },
                                        width: '100%'
                                    });

                                    $('#domicileProvince, #domicileDistrict, #domicileSubDistrict, #domicilePCode, #domicileResidential').select2({
                                        dropdownParent: $('#domicileModal'),
                                        width: '100%'
                                    });
                                });
                            });
                        </script>

                        <script>
                            let domicileModal;

                            document.addEventListener('DOMContentLoaded', function () {
                                domicileModal = new bootstrap.Modal(document.getElementById('domicileModal'));
                            });

                            function resetDomicileForm() {
                                const form = document.getElementById('domicileForm');
                                if (!form) return;

                                Array.from(form.elements).forEach(el => {
                                    const defaultValue = el.getAttribute('data-default-value');
                                    if (defaultValue !== null) {
                                        el.value = defaultValue;
                                    } else {
                                        el.value = ''; // if not set, fallback
                                    }
                                });
                            }

                            function openDomicileForm() {
                                domicileModal.show();
                            }

                            function saveDomicile() {
                                const form = document.getElementById('domicileForm');
                                const formData = new FormData(form);

                                // Validate required fields
                                // const requiredFields = ['domicileProvince', 'domicileDistrict', 'domicileSubDistrict', 'domicileAdmVillage', 'domicilePCode', 'domicileRt', 'domicileRw', 'domicileAddress', 'domicileResidential', 'domicileTotalFamily'];
                                // let isValid = true;

                                // requiredFields.forEach(field => {
                                //     const element = document.getElementById(field);
                                //     if (!element.value.trim()) {
                                //         element.classList.add('is-invalid');
                                //         isValid = false;
                                //     } else {
                                //         element.classList.remove('is-invalid');
                                //     }
                                // });

                                // if (!isValid) {
                                //     alert('Please fill in all required fields');
                                //     return;
                                // }

                                // Build complete address dari form fields
                                const province = document.getElementById('domicileProvince').value;
                                const district = document.getElementById('domicileDistrict').value;
                                const subDistrict = document.getElementById('domicileSubDistrict').value;
                                const admVillage = document.getElementById('domicileAdmVillage').value;
                                const postalCode = document.getElementById('domicilePCode').value;
                                const rt = document.getElementById('domicileRt').value;
                                const rw = document.getElementById('domicileRw').value;
                                const address = document.getElementById('domicileAddress').value;
                                const residential = document.getElementById('domicileResidential').value;

                                // Format alamat lengkap
                                let completeAddress = '';
                                if (address) completeAddress += address;
                                if (rt) completeAddress += (completeAddress ? ', RT ' : 'RT ') + rt;
                                if (rw) completeAddress += (rw ? '/RW ' + rw : '');
                                if (admVillage) completeAddress += (completeAddress ? ', ' : '') + admVillage;
                                if (subDistrict) completeAddress += (completeAddress ? ', ' : '') + subDistrict;
                                if (district) completeAddress += (completeAddress ? ', ' : '') + district;
                                if (province) completeAddress += (completeAddress ? ', ' : '') + province;
                                if (postalCode) completeAddress += (completeAddress ? ' ' : '') + postalCode;

                                // Update textarea utama dengan alamat lengkap
                                document.getElementById('domicile').value = completeAddress;

                                // Close modal
                                domicileModal.hide();

                                // Optional: Send data to server via AJAX
                                //console.log('Address saved:', Object.fromEntries(formData));
                            }

                            // Handle modal close event
                            document.getElementById('domicileModal').addEventListener('hidden.bs.modal', function () {
                                // Clear form validation classes
                                const form = document.getElementById('domicileForm');
                                const inputs = form.querySelectorAll('.form-control');
                                inputs.forEach(input => {
                                    input.classList.remove('is-invalid');
                                });
                            });
                        </script>

                        @*Make sure Select2 is initialized correctly*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                $('select').select2({
                                    width: '100%',
                                    minimumResultsForSearch: 0
                                });
                            });
                        </script>

                        @*Input validation for NPWP*@
                        <script>
                            function validateNumberInput(input) {
                                if (input.id !== "npwp") return; // Ensure validation is only for NPWP

                                let numericPart = input.value.replace(/[^0-9]/g, ''); // Extract only numbers

                                // Limit numbers to 16 digits
                                if (numericPart.length > 16) {
                                    numericPart = numericPart.slice(0, 16);
                                }

                                // Rebuild input while enforcing rules
                                let newValue = '';
                                let numCount = 0;

                                for (let char of input.value) {
                                    if (/\d/.test(char)) { // If it's a number
                                        if (numCount < 16) {
                                            newValue += char;
                                            numCount++;
                                        }
                                    } else if ((char === '.' || char === '-') && numCount < 16) {
                                        // Only allow `.` and `-` if numeric part is < 16 digits
                                        newValue += char;
                                    }
                                }

                                input.value = newValue;

                                // Apply red border if numeric part is between 1-15 digits
                                if (numericPart.length >= 1 && numericPart.length < 16) {
                                    input.classList.add("error-border");
                                } else {
                                    input.classList.remove("error-border");
                                }
                            }

                            // Remove error border when cancel button is clicked
                            document.addEventListener("DOMContentLoaded", function () {
                                const cancelButton = document.getElementById('cancelsaveButton');
                                cancelButton.addEventListener('click', function () {
                                    document.getElementById("npwp").classList.remove("error-border");
                                });
                            });

                        </script>

                        @*Input validation for Phone Number and Whatsapp Number*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll(".phone-number").forEach(function (input) {

                                    // Cegah input selain angka
                                    input.addEventListener("keypress", function (e) {
                                        if (!/[0-9]/.test(e.key)) {
                                            e.preventDefault();
                                        }
                                    });

                                    // Cegah angka 0 di posisi awal saat input masih kosong
                                    input.addEventListener("keydown", function (e) {
                                        if (e.key === "0" && input.selectionStart === 0 && input.value.length === 0) {
                                            e.preventDefault();
                                        }
                                    });

                                    // Saat input berubah
                                    input.addEventListener("input", function () {
                                        // Hapus semua karakter non-digit
                                        this.value = this.value.replace(/\D/g, '');

                                        // Hapus angka 0 di depan jika ada
                                        if (this.value.startsWith("0")) {
                                            this.value = this.value.replace(/^0+/, '');
                                        }
                                    });
                                });

                                // Jika ada tombol cancel untuk hapus error (opsional)
                                const cancelButton = document.getElementById('cancelsaveButton');
                                if (cancelButton) {
                                    cancelButton.addEventListener('click', function () {
                                        document.querySelectorAll(".phone-number").forEach(function (input) {
                                            input.classList.remove("error-border");
                                        });
                                    });
                                }
                            });
                        </script>

                        @*Input validation for Identity Number, Family Card Number, NIK*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll("input").forEach(function (input) {
                                    input.addEventListener("input", function () {
                                        if (input.classList.contains("strict-number")) {
                                            this.value = this.value.replace(/\D/g, ''); // hanya angka
                                            if (this.value.length > 16) {
                                                this.value = this.value.slice(0, 16);
                                            }

                                            if (this.value.length >= 1 && this.value.length <= 15) {
                                                this.classList.add("error-border");
                                            } else {
                                                this.classList.remove("error-border");
                                            }
                                        }
                                    });
                                });

                                document.getElementById('cancelsaveButton').addEventListener('click', function () {
                                    document.querySelectorAll("input").forEach(function (input) {
                                        input.classList.remove("error-border");
                                    });
                                });
                            });

                        </script>

                        @*Input validation for Account Number*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll(".strict-an").forEach(function (input) {
                                    input.addEventListener("input", function () {
                                        this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters

                                        // if (this.value.length > 16) {
                                        //     this.value = this.value.slice(0, 16); // Limit to 16 digits
                                        // }

                                        // Apply red border ONLY if digit count is between 1-9 (inclusive)
                                        if (this.value.length >= 1 && this.value.length <= 5) {
                                            this.classList.add("error-border");
                                        } else {
                                            this.classList.remove("error-border");
                                        }
                                    });
                                });

                                // Remove error border when cancel button is clicked
                                const cancelButton = document.getElementById('cancelsaveButton');
                                cancelButton.addEventListener('click', function () {
                                    document.querySelectorAll(".strict-an").forEach(function (input) {
                                        input.classList.remove("error-border");
                                    });
                                });
                            });

                        </script>

                        @*Input validation for BPJS Employee Number*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll(".strict-bpjsen").forEach(function (input) {
                                    input.addEventListener("input", function () {
                                        this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters

                                        if (this.value.length > 11) {
                                            this.value = this.value.slice(0, 11); // Limit to 11 digits
                                        }

                                        // Apply red border ONLY if digit count is between 1-12 (inclusive)
                                        if (this.value.length >= 1 && this.value.length <= 10) {
                                            this.classList.add("error-border");
                                        } else {
                                            this.classList.remove("error-border");
                                        }
                                    });
                                });

                                // Remove error border when cancel button is clicked
                                const cancelButton = document.getElementById('cancelsaveButton');
                                cancelButton.addEventListener('click', function () {
                                    document.querySelectorAll(".strict-bpjsen").forEach(function (input) {
                                        input.classList.remove("error-border");
                                    });
                                });
                            });

                        </script>

                        @*Input validation for BPJS Health Number*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll(".strict-bpjs").forEach(function (input) {
                                    input.addEventListener("input", function () {
                                        this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters

                                        if (this.value.length > 13) {
                                            this.value = this.value.slice(0, 13); // Limit to 11 digits
                                        }

                                        // Apply red border ONLY if digit count is between 1-12 (inclusive)
                                        if (this.value.length >= 1 && this.value.length <= 12) {
                                            this.classList.add("error-border");
                                        } else {
                                            this.classList.remove("error-border");
                                        }
                                    });
                                });

                                // Remove error border when cancel button is clicked
                                const cancelButton = document.getElementById('cancelsaveButton');
                                cancelButton.addEventListener('click', function () {
                                    document.querySelectorAll(".strict-bpjs").forEach(function (input) {
                                        input.classList.remove("error-border");
                                    });
                                });
                            });

                        </script>

                        @*Input validation for Dana Pensiun Number*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll(".strict-ndp").forEach(function (input) {
                                    input.addEventListener("input", function () {
                                        this.value = this.value.replace(/\D/g, ''); // Remove non-numeric characters

                                        if (this.value.length > 6) {
                                            this.value = this.value.slice(0, 6); // Limit to 11 digits
                                        }

                                        // Apply red border ONLY if digit count is between 1-12 (inclusive)
                                        if (this.value.length >= 1 && this.value.length <= 5) {
                                            this.classList.add("error-border");
                                        } else {
                                            this.classList.remove("error-border");
                                        }
                                    });
                                });

                                // Remove error border when cancel button is clicked
                                const cancelButton = document.getElementById('cancelsaveButton');
                                cancelButton.addEventListener('click', function () {
                                    document.querySelectorAll(".strict-bpjs").forEach(function (input) {
                                        input.classList.remove("error-border");
                                    });
                                });
                            });

                        </script>

                        @*Input validation for Insurance Number*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.querySelectorAll(".number-hyphen-only").forEach(function (input) {
                                    input.addEventListener("input", function () {
                                        let value = this.value;

                                        // Remove all non-numeric and non-hyphen characters
                                        value = value.replace(/[^0-9-]/g, '');

                                        // Ensure only ONE hyphen (-) is allowed anywhere in the input
                                        let hyphenIndex = value.indexOf("-");
                                        if (hyphenIndex !== -1) {
                                            // Keep only the first hyphen, remove any additional ones
                                            value = value.slice(0, hyphenIndex + 1) + value.slice(hyphenIndex + 1).replace(/-/g, '');
                                        }

                                        // Extract only numbers for count validation
                                        let numericPart = value.replace(/[^0-9]/g, '');

                                        // Limit number count to 7 digits (excluding hyphen)
                                        if (numericPart.length > 7) {
                                            numericPart = numericPart.slice(0, 7);
                                        }

                                        // Rebuild the input value, keeping the hyphen in its original position
                                        if (hyphenIndex !== -1) {
                                            value = numericPart.slice(0, hyphenIndex) + "-" + numericPart.slice(hyphenIndex);
                                        } else {
                                            value = numericPart;
                                        }

                                        this.value = value;

                                        // Apply red border if number count is between 1-3 digits
                                        if (numericPart.length >= 1 && numericPart.length <= 3) {
                                            this.classList.add("error-border");
                                        } else {
                                            this.classList.remove("error-border");
                                        }
                                    });
                                });

                                // Remove error border when cancel button is clicked
                                const cancelButton = document.getElementById('cancelsaveButton');
                                cancelButton.addEventListener('click', function () {
                                    document.querySelectorAll(".number-hyphen-only").forEach(function (input) {
                                        input.classList.remove("error-border");
                                    });
                                });
                            });
                        </script>

                        @*Trigger the cancel button and change to the default value*@
                        <script>
                            $(document).ready(function () {
                                // Store default values for multiple select elements
                                var defaultValues = {
                                    ts: $("#ts").data("default-value"),
                                    pob: $("#pob").data("default-value"),
                                    status: $("#status").data("default-value"),
                                    religion: $("#religion").data("default-value"),
                                    bg: $("#bg").data("default-value"),
                                    branch: $("#branch").data("default-value"),
                                    nationality: $("#nationality").data("default-value")
                                };

                                // Cancel button resets all to default values
                                $("#cancelsaveButton").on("click", function () {
                                    Object.keys(defaultValues).forEach(function (id) {
                                        $("#" + id).val(defaultValues[id]).trigger("change"); // Reset to default value
                                    });
                                });
                            });
                        </script>

                        <script>
                            $(document).ready(function () {
                                // Sembunyikan dulu
                                $('#marriedCertField, #divorceCertField, #marriedDateField, #divorceDateField').hide();
                                $('#maritalDate, #divorceDate').removeAttr('required');

                                function toggleMaritalFields(value) {
                                    if (value === 'Married' || value === 'Menikah') {
                                        $('#marriedCertField, #marriedDateField').show();
                                        $('#divorceCertField, #divorceDateField').hide();
                                        //$('#maritalDate').attr('required', true);
                                        //$('#divorceDate').attr('required', false);
                                    } else if (value === 'Widow' || value === 'Widower' || value === 'Janda' || value === 'Duda') {
                                        $('#divorceCertField, #divorceDateField').show();
                                        $('#marriedCertField, #marriedDateField').hide();
                                        //$('#divorceDate').attr('required', true);
                                        //$('#maritalDate').attr('required', false);
                                    } else {
                                        $('#marriedCertField, #marriedDateField, #divorceCertField, #divorceDateField').hide();
                                        $('#maritalDate, #divorceDate').attr('required', false);
                                    }
                                }

                                // Jalankan saat halaman load
                                toggleMaritalFields($('#status').val());

                                // Jalankan saat dropdown berubah
                                $('#status').on('change', function () {
                                    toggleMaritalFields($(this).val());
                                });
                            });
                        </script>

                        @*Set mandatory and non-mandatory based on current value of Nationality*@
                        <script>
                            document.addEventListener("DOMContentLoaded", function() {

                                 //Function for update mandatory fields
                                 function updateMandatoryFields(valueNationality) {
                                     const isEditBtnVisible = $("#editProfileButton").is(":visible");
                                     if (isEditBtnVisible) return; // not in edit mode

                                     const isWNI = valueNationality.toLowerCase().includes("indonesia");
                                     console.log("sss:",isWNI)
                                     if (isWNI) {
                                         // $(".non-mandatory-wna").show();
                                         // $(".non-mandatory-input-wna").prop('required', true);
                                         // $(".non-mandatory-wni").hide();
                                         // $(".non-mandatory-input-wni").removeAttr('required');

                                         $("#idn").addClass("strict-number");
                                         $("#eniks").addClass("strict-number");
                                         $("#niks").addClass("strict-number");
                                     } else {
                                         // $(".non-mandatory-wni").show();
                                         // $(".non-mandatory-input-wni").prop('required', true);
                                         // $(".non-mandatory-wna").hide();
                                         // $(".non-mandatory-input-wna").removeAttr('required');

                                         $("#idn").removeClass("strict-number");
                                         $("#eniks").removeClass("strict-number");
                                        $("#niks").removeClass("strict-number");
                                     }
                                 }

                                $("#editProfileButton").on("click", function () {
                                    // $(".mandatory-asterisk").show();
                                     updateMandatoryFields($('#nationality').val());
                                    document.getElementById("asterisk-name").style.display = "inline";
                                });

                                $("#cancelsaveButton").on("click", function () {
                                    // $(".mandatory-asterisk").hide();
                                    document.getElementById("asterisk-name").style.display = "none";
                                });

                                // Event listener for Select2
                                 $('#nationality').on('change', function() {
                                     updateMandatoryFields(this.value);
                                 });

                                $('#familyView').on('shown.bs.modal', function () {
                                    const nationalityVal = $('#nationality').val();
                                    if (nationalityVal) {
                                        updateMandatoryFields(nationalityVal);
                                    }
                                });

                                $('#familyViewadd').on('shown.bs.modal', function () {
                                    const nationalityVal = $('#nationality').val();
                                    if (nationalityVal) {
                                        updateMandatoryFields(nationalityVal);
                                    }
                                });
                            });

                        </script>

                        <script>
                            // Get the Edit Profile button
                            const editProfileButton = document.getElementById('editProfileButton');

                            // Get the Save and Cancel buttons
                            const saveButton = document.getElementById('saveprofileButton');
                            const cancelButton = document.getElementById('cancelsaveButton');

                            // Get the form inputs that you want to enable
                            const formInputs = [
                                document.getElementById('insuranceno'),
                                document.getElementById('bpjs'),
                                document.getElementById('ts'),
                                document.getElementById('idn'),
                                document.getElementById('kk'),
                                document.getElementById('npwp'),
                                document.getElementById('accountnumber'),
                                document.getElementById('accountname'),
                                document.getElementById('nationality'),
                                document.getElementById('dob'),
                                document.getElementById('address'),
                                document.getElementById('status'),
                                document.getElementById('religion'),
                                document.getElementById('bg'),
                                document.getElementById('pob'),
                                document.getElementById('branch'),
                                document.getElementById('namess'),
                                document.getElementById('genderss'),
                                document.getElementById('ben'),
                                document.getElementById('ndp'),
                                document.getElementById('phone'),
                                document.getElementById('simanumber'),
                                document.getElementById('simcnumber'),
                                document.getElementById('identityName'),
                                document.getElementById('passport'),
                                document.getElementById('personalEmail'),
                                document.getElementById('wanum'),
                                document.getElementById('waCode'),
                                document.getElementById('phoneCode'),
                                document.getElementById('divorceDate'),
                                document.getElementById('maritalDate'),
                                document.getElementById('divCerNum'),
                                document.getElementById('marCerNum'),
                                document.getElementById('domicile')
                            ];

                            // Store the original values when the page loads

                            const kendoDateFields = ['dob', 'maritalDate', 'divorceDate'];
                            const originalValues = {};
                            formInputs.forEach(input => {
                                if (input && kendoDateFields.includes(input.id)) {
                                    const kendoInput = $("#" + input.id).data("kendoDatePicker");
                                    if (kendoInput) {
                                        originalValues[input.id] = kendoInput.value();
                                        //console.log(`Initial ${input.id} value:`, originalValues[input.id]);
                                    }
                                } else if (input) {
                                    originalValues[input.id] = input.value;
                                }
                            });

                            // Add event listener to the Edit Profile button
                            editProfileButton.addEventListener('click', function () {
                                formInputs.forEach(input => {
                                    if (input && kendoDateFields.includes(input.id)) {
                                        const kendoInput = $("#" + input.id).data("kendoDatePicker");
                                        if (kendoInput) {
                                            originalValues[input.id] = kendoInput.value();
                                            //console.log(`Updated original ${input.id} before edit:`, originalValues[input.id]);
                                        }
                                    } else if (input) {
                                        originalValues[input.id] = input.value;
                                    }
                                });

                                // Enable the form inputs
                                formInputs.forEach(input => {
                                    if (input && kendoDateFields.includes(input.id)) {
                                        const kendoInput = $("#" + input.id).data("kendoDatePicker");
                                        if (kendoInput) {
                                            kendoInput.enable(true);
                                        }
                                    } else if (input) {
                                        input.disabled = false;
                                    }
                                });

                                // Show Save and Cancel buttons
                                saveButton.hidden = false;
                                cancelButton.hidden = false;

                                // Hide Edit Profile button
                                editProfileButton.hidden = true;
                            });

                            // Add event listener to the Cancel button
                            cancelButton.addEventListener('click', function () {
                                formInputs.forEach(input => {
                                    if (input && kendoDateFields.includes(input.id)) {
                                        const kendoInput = $("#" + input.id).data("kendoDatePicker");
                                        if (kendoInput) {
                                            kendoInput.value(originalValues[input.id]);
                                            kendoInput.enable(false);
                                            //console.log(`Restoring ${input.id} to:`, originalValues[input.id]);
                                        }
                                    } else if (input) {
                                        input.value = originalValues[input.id] || '';
                                        input.disabled = true;
                                    }
                                });

                                // Hide Save and Cancel buttons
                                saveButton.hidden = true;
                                cancelButton.hidden = true;

                                // Show Edit Profile button
                                editProfileButton.hidden = false;
                                resetAddressForm();
                            });

                            // Add validation before saving
                            saveButton.addEventListener('click', function (event) {
                                const accountNumberInput = document.getElementById('accountnumber');
                                const npwpInput = document.getElementById('npwp');
                                const bpjsInput = document.getElementById('bpjs');
                                const bpjsenInput = document.getElementById('ben');
                                const idnInput = document.getElementById('idn');
                                const kkInput = document.getElementById('kk');
                                const ndpInput = document.getElementById('ndp');
                                const insuranceNoInput = document.getElementById('insuranceno');

                                const accountNumber = accountNumberInput.value.trim();
                                const npwp = npwpInput.value.replace(/[^0-9]/g, ''); 
                                const bpjs = bpjsInput.value.replace(/[^0-9]/g, ''); 
                                const bpjsen = bpjsenInput.value.replace(/[^0-9]/g, '');
                                const idn = idnInput.value.replace(/[^0-9]/g, ''); 
                                const kk = kkInput.value.replace(/[^0-9]/g, '');
                                const ndp = ndpInput.value.replace(/[^0-9]/g, '');
                                const insuranceNo = insuranceNoInput.value.replace(/[^0-9]/g, '');

                                const nationalityInput = document.getElementById('nationality');
                                const isWNI = nationalityInput.value.toLowerCase().includes("indonesia");

                                console.log("TEST: ",ndp);

                                let errorMessage = '';

                                if ((accountNumberInput.hasAttribute('required') || accountNumber !== '') && accountNumber.length < 6) {
                                    errorMessage += "Account number must contain at least more than 5 digits.<br>";
                                }

                                if ((npwpInput.hasAttribute('required') || npwp !== '') && npwp.length !== 16) {
                                    errorMessage += "NPWP must contain exactly 16 digits.<br>";
                                }

                                if ((bpjsInput.hasAttribute('required') || bpjs !== '') && bpjs.length !== 13) {
                                    errorMessage += "BPJS Health Number must contain exactly 13 digits.<br>";
                                }

                                // Allow empty but validate if filled
                                // if ((bpjsenInput.hasAttribute('required') || bpjsen !== '') && bpjsen.length !== 11) {
                                    // errorMessage += "BPJS Employment Number must contain exactly 11 digits.<br>";
                                // }

                                if ((ndpInput.hasAttribute('required') || ndp !== '') && ndp.length !== 6) {
                                    errorMessage += "No Dana Pensiun must contain exactly 6 digits.<br>";
                                }

                                if ((idnInput.hasAttribute('required') || idn !== '') && isWNI && idn.length !== 16) {
                                    errorMessage += "Identity Number / KTP Number must contain exactly 16 digits.<br>";
                                }

                                if ((kkInput.hasAttribute('required') || kk !== '') && isWNI && kk.length !== 16) {
                                    errorMessage += "Family Card Number must contain exactly 16 digits.<br>";
                                }

                                if ((insuranceNoInput.hasAttribute('required') || insuranceNo !== '') && insuranceNo.length < 7) {
                                    errorMessage += "Insurance Number must contain exactly 7 digits.<br>";
                                }

                                //if (npwp != idn) {
                                //    errorMessage += "Identity Number must be same as NPWP.<br>";
                                //}

                                console.log(app);

                                if (errorMessage) {
                                    event.preventDefault(); 
                                    app.error(errorMessage.trim());
                                }
                            });
                        </script>

                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.getElementById("editProfileForm").addEventListener("submit", function (event) {
                                    event.preventDefault(); // Prevent default form submission

                                    let form = document.getElementById("editProfileForm");

                                    // Check if required fields are filled
                                    if (!form.checkValidity()) {
                                        form.reportValidity(); // Show validation messages
                                        return false; // Stop submission
                                    }

                                    // If valid, show confirmation alert
                                    app.confirm("@Localizer["Are you sure you want to update profile?"]", function (d) {
                                        if (d.value) {
                                            // Collect form data
                                            var profileEdits = {
                                                Noreg: $('#noreg').val(),
                                                Pob: $('#pob').val(),
                                                Dob: $('#dob').data("kendoDatePicker").value() ?
                                                    kendo.toString($('#dob').data("kendoDatePicker").value(), "yyyy-MM-dd") : null,
                                                Nik: $('#idn').val(),
                                                Address: $('#addressAddress').val(),
                                                Region: $('#addressProvince').val(),
                                                District: $('#addressDistrict').val(),
                                                SubDistrict: $('#addressSubDistrict').val(),
                                                AdmVillage: $('#addressAdmVillage').val(),
                                                PostalCode: $('#addressPCode').val(),
                                                Rt: $('#addressRt').val(),
                                                Rw: $('#addressRw').val(),
                                                ResidentStatus: $('#addressResidential').val(),
                                                DomicileRegion: $('#domicileProvince').val(),
                                                DomicileDistrict: $('#domicileDistrict').val(),
                                                DomicileSubDistrict: $('#domicileSubDistrict').val(),
                                                DomicileAdmVillage: $('#domicileAdmVillage').val(),
                                                DomicilePostalCode: $('#domicilePCode').val(),
                                                DomicileRt: $('#domicileRt').val(),
                                                DomicileRw: $('#domicileRw').val(),
                                                DomicileResidentStatus: $('#domicileResidential').val(),
                                                DomicileTotalFamily: $('#domicileTotalFamily').val(),
                                                Kk: $('#kk').val(),
                                                Npwp: $('#npwp').val(),
                                                AccountNumber: $('#accountnumber').val(),
                                                AccountName: $('#accountname').val(),
                                                Religion: $('#religion').val(),
                                                BloodGroup: $('#bg').val(),
                                                TaxStatus: $('#ts').val(),
                                                Bpjs: $('#bpjs').val(),
                                                Bpjsen: $('#ben').val(),
                                                InsuranceNo: $('#insuranceno').val(),
                                                Name: $('#namess').val(),
                                                Gender: $('#genderss').val(),
                                                Branch: $('#branch').val(),
                                                Status: $('#status').val(),
                                                Nationality: $('#nationality').val(),
                                                PhoneNumber: $('#phoneCode').val() + ' ' + $('#phone').val(),
                                                IdentityCardName: $('#identityName').val(),
                                                SimANumber: $('#simanumber').val(),
                                                SimCNumber: $('#simcnumber').val(),
                                                PassportNumber: $('#passport').val(),
                                                PersonalEmail: $('#personalEmail').val(),
                                                WhatsappNumber: $('#waCode').val() + ' ' + $('#wanum').val(),
                                                Domicile: $('#domicileAddress').val(),
                                                DanaPensiun: $('#ndp').val(),
                                                MarriedNumber: $('#marCerNum').val(),
                                                DivorceNumber: $('#divCerNum').val(),
                                                DivorceDate: $('#divorceDate').data("kendoDatePicker").value() ?
                                                    kendo.toString($('#divorceDate').data("kendoDatePicker").value(), "yyyy-MM-dd") : null,
                                                MarriedDate: $('#maritalDate').data("kendoDatePicker").value() ?
                                                    kendo.toString($('#maritalDate').data("kendoDatePicker").value(), "yyyy-MM-dd") : null,
                                            };

                                            // API URL
                                            var url = '@Url.Content("~/api/employe-profile/updateprofiledata")';

                                            // Call the API
                                            $.ajax({
                                                url: url,
                                                type: 'POST',
                                                contentType: 'application/json',
                                                data: JSON.stringify(profileEdits),
                                                success: function (response) {
                                                    app.success("@Localizer["Profile details updated successfully."]", "");
                                                    location.reload();
                                                },
                                                error: function (xhr, status, error) {
                                                    app.error("@Localizer["Failed to update profile details."]", "");
                                                }
                                            });
                                        }
                                    });

                                    return false; // Prevent default form submission
                                });
                            });
                        </script>

                        <div id="OA" class="tabcontent">
                            @(
                                Html.Kendo().Grid(organizationalAssignments)
                                .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                .Name("organizationGrid")
                                .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                .Pageable(options =>
                                {
                                    options.Input(true);
                                    options.Numeric(false);
                                    options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                })
                                .Scrollable(s => s.Enabled(true).Height("auto"))
                                .Resizable(resizable => resizable.Columns(true))
                                .Columns(columns =>
                                {
                                    columns.Bound(x => x.OrgName).Title("Organization").Width(150);
                                    columns.Bound(x => x.JobName).Title("Job").Width(150);
                                    columns.Bound(x => x.PostName).Title("Position").Width(150);
                                    columns.Bound(x => x.StartDate).Title("Start Date").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.EndDate).Title("End Date").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                })
                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No personal development found"].Value + "</div>"))
                                .Deferred()
                                )
                        </div>

                        <div id="Education" class="tabcontent">
                            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                            <!-- Add Education Button with Plus Icon -->
                            <button type="button" class="btn btn-primary" onclick='educationModal()' style="float:right;" @(isTerminated ? "disabled" : "")>
                                <i class="fa fa-plus"></i> Add Education
                            </button>

                           
                            <script type="text/javascript">
                                // Ensure the function is defined after the document is ready
                                $(document).ready(function () {
                                    // Function to open the modal for editing
                                    window.educationModal = function () {
                                        // Open the modal
                                        $('#educationView').modal('show');
                                    };
                                });

                            </script>

                          
                                <!-- Modal Structure -->
                                <div class="modal fade" id="educationView" tabindex="-1" aria-hidden="true" role="dialog">
                                    <div class="modal-dialog modal-custom-size" style="max-width:850px;">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="educationModalLabel">Add Education Detail</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">
                                            <form id="addeducationForm" method="post" enctype="multipart/form-data">
                                                    <div class="card-content">
                                                        <div class="card-body">
                                                            <div class="row">
                                                                <!-- Left Column -->
                                                                <div class="col-md-6 col-sm-12">
                                                                    <fieldset>
                                                                        <legend>@Localizer["Education Data"]</legend>

                                                                        <!-- Education Level -->
                                                                        <div class="form-group">
                                                                        <span style="color: red;">*</span><label class="form-label">Education Level</label>
                                                                            <select class="form-control" id="educationLevels">
                                                                            <option value="" disabled selected>Please select Education</option>
                                                                                @foreach (var edulevelList in (IEnumerable<string>)ViewData["eduLevelList"])
                                                                                {
                                                                                    <option value="@edulevelList">@edulevelList</option>
                                                                                }
                                                                            </select>
                                                                        </div>

                                                                    <div class="form-group">
                                                                        <span style="color: red;" id="spanprofiles">*</span><label for="nationality">Country</label>
                                                                        <select class="form-control" id="edunationality" name="edunationality" data-default-value="@ViewData["Nationality"]">
                                                                            <option value="" disabled selected>Please select Country</option>
                                                                            @foreach (var nationality in (IEnumerable<string>)ViewData["NationalityList"])
                                                                            {
                                                                                <option value="@nationality">@nationality</option>
                                                                            }
                                                                        </select>
                                                                    </div>

                                                                        <!-- College Selection -->
                                                                        <div class="form-group">
                                                                        <span style="color: red;">*</span><label class="form-label">College</label>
                                                                            <select class="form-control" id="colleges">
                                                                                <option value="">Please Select College</option>
                                                                                @foreach (var collageList in (IEnumerable<string>)ViewData["collageList"])
                                                                                {
                                                                                    <option value="@collageList">@collageList</option>
                                                                                }
                                                                            </select>
                                                                        </div>

                                                                        <!-- Other College Checkbox -->
                                                                        <div class="form-group" style="padding-left:20px;">
                                                                            <input type="checkbox" class="form-check-input" id="othersEdu">
                                                                            <label class="form-check-label" for="othersEdu">Other</label>
                                                                        </div>

                                                                        <!-- Hidden Field for User NoReg -->
                                                                        <input type="hidden" id="NoregsEDU" name="NoregsEDU" value="@ProfileData.NoReg">

                                                                        <!-- Start Graduation Period -->
                                                                        <div class="form-group">
                                                                        <span style="color: red;">*</span><label class="form-label">Start Education Date</label>
                                                                            @*<input type="date" class="form-control" id="speriods">*@
                                                                        @(Html.Kendo().DatePicker()
                                                                            .Name("speriods")
                                                                            .HtmlAttributes(new
                                                                            {
                                                                                id = "speriods",
                                                                                @class = "form-control"
                                                                            })
                                                                            .Value(ViewData["startEducationDate"] != null && !string.IsNullOrEmpty(ViewData["startEducationDate"].ToString())
                                                                            ? Convert.ToDateTime(ViewData["startEducationDate"])
                                                                            : (DateTime?)null)
                                                                            .Format("dd/MM/yyyy")
                                                                            .Deferred()
                                                                            )
                                                                        </div>

                                                                        <!-- Graduation Period -->
                                                                        <div class="form-group">
                                                                        <span style="color: red;">*</span><label class="form-label">Graduation Period</label>
                                                                            @*<input type="date" class="form-control" id="periods">*@
                                                                        @(Html.Kendo().DatePicker()
                                                                            .Name("periods")
                                                                            .HtmlAttributes(new
                                                                            {
                                                                                id = "periods",
                                                                                @class = "form-control"
                                                                            })
                                                                            .Value(ViewData["graduationDate"] != null && !string.IsNullOrEmpty(ViewData["graduationDate"].ToString())
                                                                            ? Convert.ToDateTime(ViewData["graduationDate"])
                                                                            : (DateTime?)null)
                                                                            .Format("dd/MM/yyyy")
                                                                            .Deferred()
                                                                            )
                                                                        </div>

                                                                        <!-- Major Selection -->
                                                                        <div class="form-group">
                                                                            <span style="color: red;">*</span> <label class="form-label">Major</label>
                                                                            <select class="form-control" id="majors">
                                                                            <option value="" disabled selected>Please select Major</option>
                                                                            <option value="m00">-</option>
                                                                                @foreach (var majorLists in (IEnumerable<string>)ViewData["majorList"])
                                                                                {
                                                                                    <option value="@majorLists">@majorLists</option>
                                                                                }
                                                                            </select>
                                                                        </div>

                                                                        <!-- GPA Input -->
                                                                        <div class="form-group">
                                                                             <span style="color: red;">*</span> <label class="form-label">GPA</label>
                                                                        <input type="number" class="form-control" id="gpas" step="any" placeholder="Enter GPA (e.g., 4.00)">
                                                                        </div>
                                                                    </fieldset>
                                                                </div>

                                                                <!-- Right Column -->
                                                                <div class="col-md-6 col-sm-12">
                                                                    <fieldset>
                                                                       <legend>@Localizer["Supporting Attachment"]</legend>
                                                                        <!-- Upload Transcript -->
                                                                        <div class="mb-3">
                                                                        <label class="form-label">Certificate</label>
                                                                            <input type="file" class="form-control" id="transcript" accept=".pdf,.docx,.jpg,.png" onchange="previewFile()">
                                                                            <div id="filePreview" class="mt-2"></div>
                                                                        </div>
                                                                </fieldset>
                                                                <fieldset>
                                                                    <legend>@Localizer["Notes"]</legend>
                                                                        <!-- Notes Detail -->
                                                                        <div class="mb-3">
                                                                            <label class="form-label">Notes Detail</label>
                                                                            <textarea class="form-control" id="nd"></textarea>
                                                                        </div>
                                                                    </fieldset>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                            
                                            <!-- Modal Footer -->
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                <button type="submit"  class="btn btn-primary">Save</button>
                                            </div>
                                            </form>
                                        </div>
                                        </div>
                                    </div>
                                </div>
                        
                             <script>
                                $(document).ready(function () {
                                    $('#educationView').on('shown.bs.modal', function () {
                                        // Initialize Select2 for both dropdowns inside the modal
                                        $('#educationLevels,#edunationality, #colleges, #majors').select2({
                                            dropdownParent: $('#educationView'),
                                            width: '100%' 
                                        });
                                    });
                                });
                            </script>

                           
                            
                            <script>
                                $(document).ready(function () {
                                    $("#educationLevels, #majors, #colleges").select2();

                                    $("#educationLevels").on("change", function () {
                                        let selectedEdu = $(this).val().trim();
                                        let majorField = $("#majors");

                                        if (selectedEdu === "Kursus" || selectedEdu === "Training" || selectedEdu === "Academy" || selectedEdu === "Seminar" || selectedEdu === "SD & Sederajat" || selectedEdu === "SMP & Sederajat") {
                                            majorField.val('m00').trigger("change");
                                            majorField.prop("disabled", true);
                                        } else {
                                            majorField.val(null).trigger("change");
                                            majorField.prop("disabled", false);
                                        }
                                    });

                                    $("#othersEdu").on("change", function () {
                                        let collegeField = $("#colleges");

                                        if (this.checked) {
                                            collegeField.val(null).trigger("change");
                                            collegeField.prop("disabled", true);
                                        } else {
                                            collegeField.val(null).trigger("change");
                                            collegeField.prop("disabled", false);
                                        }
                                    });

                                    $("#gpas").on("blur", function () {
                                        let gpa = $(this).val().trim();

                                        if (gpa !== "" && !gpa.includes(".")) {
                                            $(this).val(gpa + ".00");
                                        }
                                    });
                                });

                            </script>

                            <script>
                                document.addEventListener("DOMContentLoaded", function () {
                                    document.getElementById("addeducationForm").addEventListener("submit", function (event) {
                                        event.preventDefault(); // Prevent default form submission

                                        let form = document.getElementById("addeducationForm");

                                        // // Ensure either a college is selected OR "Other" checkbox is checked
                                        // let collegeSelected = document.getElementById("colleges").value.trim() !== "";
                                        // // let eduSelected = document.getElementById("educationLevels").value.trim(); 
                                        // let otherChecked = document.getElementById("othersEdu").checked;
                                       

                                        // if (!collegeSelected && !otherChecked) {
                                        //     app.error("Please select a college or check 'Other' before submitting.");
                                        //     return false;
                                        // }

                                        let isValid = true;
                                        let requiredFields = ["educationLevels", "periods", "speriods", "majors", "gpas", "edunationality"];
                                        let collegeInput = document.getElementById("colleges");
                                        let otherCollegeCheckbox = document.getElementById("othersEdu");

                                        // Validate standard required fields
                                        requiredFields.forEach(function (fieldId) {
                                            let input = document.getElementById(fieldId);
                                            let select2Element = $(input).next('.select2-container'); // Get Select2 wrapper

                                            if (!input.value.trim()) {
                                                isValid = false;
                                                input.classList.add("border", "border-danger"); // Highlight normal inputs
                                                if (select2Element.length > 0) {
                                                    select2Element.css("border", "1px solid red"); // Highlight Select2
                                                }
                                            } else {
                                                input.classList.remove("border", "border-danger"); // Remove highlight if valid
                                                if (select2Element.length > 0) {
                                                    select2Element.css("border", ""); // Remove highlight from Select2
                                                }
                                            }
                                        });

                                        // Validate College & Other College (at least one must be selected)
                                        let collegeValid = collegeInput.value.trim() !== "";
                                        let otherCollegeValid = otherCollegeCheckbox.checked;

                                        if (!collegeValid && !otherCollegeValid) {
                                            isValid = false;
                                            $(collegeInput).next('.select2-container').css("border", "1px solid red"); // Highlight Select2
                                        } else {
                                            $(collegeInput).next('.select2-container').css("border", ""); // Remove highlight
                                        }

                                        // Show error if validation fails
                                        if (!isValid) {
                                            app.error("Please complete all required fields before proceeding.");
                                            return false;
                                        }

                                      
                                        // Check if required fields are filled
                                        if (!form.checkValidity()) {
                                            form.reportValidity(); // Show validation messages
                                            return false; // Stop submission
                                        }

                                        // Collect form data
                                        var educationDatas = {
                                            Noreg: $('#NoregsEDU').val(), // Assuming you are passing NoReg value
                                            EducationLevel: $('#educationLevels').val(),
                                            Collage: $('#colleges').val(),
                                            Other: $('#othersEdu').prop('checked'), // Get checkbox value (true/false)
                                            StartEducationDate: $('#speriods').data('kendoDatePicker').value() ?
                                                kendo.toString($('#speriods').data('kendoDatePicker').value(), "yyyy/MM/dd") : '',
                                            GraduationDate: $('#periods').data('kendoDatePicker').value() ?
                                                kendo.toString($('#periods').data('kendoDatePicker').value(), "yyyy/MM/dd") : '',
                                            Major: $('#majors').val(),
                                            Country: $('#edunationality').val(),
                                            GPA: String($('#gpas').val())
                                        };

                                        // API URL (Ensure it's correct for your server routing)
                                        var url = '@Url.Content("~/api/employe-profile/addeducation")';

                                        // Call the API
                                        $.ajax({
                                            url: url,
                                            type: 'POST',
                                            contentType: 'application/json',
                                            data: JSON.stringify(educationDatas),
                                            success: function (response) {
                                                app.success("Education data added successfully.", "");
                                                location.reload();
                                            },
                                            error: function (xhr, status, error) {
                                                app.error("Failed to add education data.", "");
                                            }
                                        });
                                    });
                                });
                            </script>


                         

                            <br />
                            <br />
                            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                            @(
                                Html.Kendo().Grid(eduDatas)
                                .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                .Name("educationGrid")
                                .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                .Pageable(options =>
                                {
                                    options.Input(true);
                                    options.Numeric(false);
                                    options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                })
                                .Scrollable(s => s.Enabled(true).Height("auto"))
                                .Resizable(resizable => resizable.Columns(true))
                                .Columns(columns =>
                                {
                                    columns.Bound("EducationTypeName").Title("Education").Width(131);
                                    columns.Bound("Institute").Title("Name").ClientTemplate(@"
                            <text>#: Institute != '' ? Institute : 'N/A' #</text>
                            ").Width(187);
                                    columns.Bound("MajorName").Title("Major").Width(151);
                                    columns.Bound("CountryName").Title("Country").Width(131);

                                    columns.Bound("NoReg").Title("NoReg").Hidden(true);

                                    columns.Bound("StartEducationDate").Title("sdate").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(150).Hidden(true);

                                    columns.Bound("GraduationDate").Title("gdate").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(150).Hidden(true);

                                    columns.Bound("FinalGrade").Hidden(true);

                                    columns.Bound("Id").Title("Action").HtmlAttributes(new { @class = "text-center" }).ClientTemplate(@"
                            <div style='display:flex; gap: 5px; justify-content: center; align-items: center; width: 100%; min-height: 40px;'>
                            <button class='btn btn-link p-1' style='display: flex; align-items: center; justify-content: center;' onclick='editModal(""#= EducationTypeName #"", ""#= Institute #"", ""#= MajorName.toLowerCase() #"", ""#= kendo.toString(StartEducationDate, ""yyyy-MM-dd"") #"", ""#= kendo.toString(GraduationDate, ""yyyy-MM-dd"") #"", ""#= FinalGrade #"", ""#= CountryName #"", ""#= NoReg #"", ""#= Id #"")'>
                            <i class='fa fa-pencil'></i>
                            </button>
                            <button class='btn btn-link p-1' style='display: flex; align-items: center; justify-content: center;' onclick='deleteEduConfirmation(""#= Id #"")'>
                            <i class='fa fa-trash text-danger'></i>
                            </button>
                            </div>
                            ").Width(100);

                                })
                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No personal development found"].Value + "</div>"))
                                .Deferred()
                                )
                        </div>

                        <script>
                            function deleteEduConfirmation(id) {
                                Swal.fire({
                                    title: 'Are you sure?',
                                    text: "You won't be able to revert this!",
                                    type: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Yes, delete it!'
                                }).then((result) => {
                                    //console.log(id);
                                    if (result.value) {
                                        deleteData(id);
                                    }
                                });
                            }

                            function deleteData(id) {
                                var url = '@Url.Content("~/api/employe-profile/")' + id;

                                $.ajax({
                                    url: url,
                                    type: 'DELETE',
                                    success: function (response) {
                                        Swal.fire(
                                            'Deleted!',
                                            'Your record has been deleted.',
                                            'success'
                                        );
                                        console.log("success");
                                        location.reload();
                                    },
                                    error: function (xhr, status, error) {
                                        var errorMessage = "An unexpected error occurred.";
                                        if (xhr.responseJSON && xhr.responseJSON.message) {
                                            errorMessage = xhr.responseJSON.message;
                                        }

                                        Swal.fire(
                                            'Error!',
                                            errorMessage,
                                            'error'
                                        );
                                    }
                                });
                            }
                        </script>

                        <script>
                            // Make sure the function is accessible globally
                            function editModal(EducationTypeName, Institute, MajorName, StartEducationGrade, GraduationDate, FinalGrade, CountryName, NoReg, Id) {

                                // Set the selected FamilyTypeCode in the dropdown
                                $('#educationLevel').val(EducationTypeName);

                                $('#collageedit').val(Institute);

                                $('#major').val(MajorName);

                                $('#NoregEDU').val(NoReg);

                                $('#gpanumber').val(FinalGrade);

                                $('#IdEdu').val(Id);

                                $('#edunationalitys').val(CountryName).trigger('change');

                                var startDatePicker = $('#sGraduationDates').data('kendoDatePicker');
                                var gradDatePicker = $('#GraduationDates').data('kendoDatePicker');

                                if (startDatePicker && StartEducationGrade) {
                                    startDatePicker.value(new Date(StartEducationGrade));
                                }

                                if (gradDatePicker && GraduationDate) {
                                    gradDatePicker.value(new Date(GraduationDate));
                                }


                                $('#editModal').modal('show');
                            }

                        </script>

                     
                        <!-- Modal HTML -->
                        <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true" role="dialog">
                            <div class="modal-dialog modal-custom-size" style="max-width:850px;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="educationModalLabel">Edit Education Detail</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form id="educationeditForm" method="post" enctype="multipart/form-data">
                                            <div class="card-content">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <!-- Left Column -->
                                                        <div class="col-md-6 col-sm-12">
                                                            <fieldset>
                                                                <legend>@Localizer["Education Data"]</legend>

                                                <div class="form-group">
                                                         <span style="color: red;">*</span><label for="educationLevel" class="form-label">Education Level</label>
                                                        <select class="form-control" id="educationLevel">
                                                         <option value="" disabled selected>Please select Education</option>
                                                            @foreach (var edulevelList in (IEnumerable<string>)ViewData["eduLevelList"])
                                                            {

                                                                <option value="@edulevelList">@edulevelList</option>

                                                            }
                                                        </select>
                                                    </div>

                                                    <div class="form-group">
                                                        <span style="color: red;" id="spanprofiles">*</span><label for="nationality">Country</label>
                                                                    <select class="form-control" id="edunationalitys" name="edunationality" data-default-value="@Html.Encode(ViewData["Nationality"])">
                                                            @foreach (var nationality in (IEnumerable<string>)ViewData["NationalityList"])
                                                            {
                                                                <option value="@nationality">@nationality</option>
                                                            }
                                                        </select>
                                                    </div>

                                                    <!-- College Dropdown -->
                                                <div class="form-group">
                                                       <span style="color: red;">*</span><label for="collageedit" class="form-label">Collage</label>
                                                        <select class="form-control" id="collageedit">
                                                            <option value="">-</option>
                                                            @foreach (var collageList in (IEnumerable<string>)ViewData["collageList"])
                                                            {

                                                                <option value="@collageList">@collageList</option>

                                                            }
                                                        </select>
                                                    </div>

                                                    <!-- Others Checkbox -->
                                                <div class="form-group">
                                                        <div class="form-check">
                                                            <input type="checkbox" class="form-check-input" id="othersedus">
                                                            <label class="form-check-label" for="othersedus">Other</label>
                                                        </div>
                                                    </div>

                                                    <input type="text" class="form-control" id="NoregEDU" required hidden>

                                                     <input type="text" class="form-control" id="IdEdu" required hidden>

                                                     <div class="form-group">
                                                         <span style="color: red;">*</span><label for="GraduationDates" class="form-label">Start Education Date</label>
                                                         @*<input type="date" class="form-control" id="sGraduationDates">*@
                                                                    @(Html.Kendo().DatePicker()
                                                                        .Name("sGraduationDates")
                                                                        .HtmlAttributes(new
                                                                        {
                                                                            id = "sGraduationDates",
                                                                            @class = "form-control"
                                                                        })
                                                                        .Value(ViewData["startGraduationDate"] != null && !string.IsNullOrEmpty(ViewData["startGraduationDate"].ToString())
                                                                        ? Convert.ToDateTime(ViewData["startGraduationDate"])
                                                                        : (DateTime?)null)
                                                                        .Format("dd/MM/yyyy")
                                                                        .Deferred()
                                                                        )
                                                     </div>

                                                     <div class="form-group">
                                                         <span style="color: red;">*</span><label for="GraduationDates" class="form-label">Graduation Period</label>
                                                        @*<input type="date" class="form-control" id="GraduationDates">*@
                                                                    @(Html.Kendo().DatePicker()
                                                                        .Name("GraduationDates")
                                                                        .HtmlAttributes(new
                                                                        {
                                                                            id = "GraduationDates",
                                                                            @class = "form-control"
                                                                        })
                                                                        .Value(ViewData["graduationDate"] != null && !string.IsNullOrEmpty(ViewData["graduationDate"].ToString())
                                                                        ? Convert.ToDateTime(ViewData["graduationDate"])
                                                                        : (DateTime?)null)
                                                                        .Format("dd/MM/yyyy")
                                                                        .Deferred()
                                                                        )
                                                    </div>

                                                    <!-- Major Field (Initially disabled) -->
                                                    <div class="form-group">
                                                         <span style="color: red;">*</span><label for="major" class="form-label">Major</label>
                                                        <select class="form-control" id="major">
                                                           <option value="m00">-</option>
                                                            @foreach (var majorLists in (IEnumerable<string>)ViewData["majorLister"])
                                                            {

                                                                <option value="@majorLists">@majorLists</option>

                                                            }
                                                        </select>
                                                    </div>

                                                    <!-- GPA Field (Initially disabled) -->
                                                    <div class="form-group">
                                                         <span style="color: red;">*</span><label for="gpanumber" class="form-label">GPA</label>
                                                                    <input type="number" class="form-control" id="gpanumber" step="any" placeholder="Enter GPA (e.g., 4.00)">
                                                    </div>
                                                   </fieldset>
                                                </div>

                                              <div class="col-md-6 col-sm-12">
                                                 <fieldset>
                                                   <legend>@Localizer["Supporting Attachment"]</legend>
                                                    <!-- Upload Transcript -->
                                                    <div class="mb-3">
                                                       <label for="certificate" class="form-label">Certificate</label>
                                                        <input type="file" class="form-control" id="certificate" accept=".pdf,.docx,.jpg,.png" onchange="previewFiles()">
                                                        <div id="filePreviews" class="mt-2"></div>
                                                    </div>
                                                            </fieldset>

                                                             <fieldset>
                                                   <legend>@Localizer["Notes"]</legend>
                                                    <!-- Year -->
                                                    <div class="mb-3">
                                                        <label for="nd" class="form-label">Notes Detail</label>
                                                        <textarea class="form-control" id="nd"> </textarea>
                                                     </div>
                                                  </fieldset>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                        
                                   
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary" id="editeducationButton">Save</button>

                                    </div>
                                      </form>
                                      </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            $(document).ready(function () {
                                $('#editModal').on('shown.bs.modal', function () {
                                    // Initialize Select2 for both dropdowns inside the modal
                                    $('#educationLevel,#edunationalitys, #collageedit, #major').select2({
                                        dropdownParent: $('#editModal'),
                                        width: '100%' 
                                    });
                                });
                            });
                        </script>

                        <script>
                            $(document).ready(function () {
                                $("#educationLevel, #major, #collageedit").select2();

                                $("#educationLevel").on("change", function () {
                                    let selectedEdu = $(this).val().trim();
                                    let majorField = $("#major");

                                    if (selectedEdu === "Kursus" || selectedEdu === "Training" || selectedEdu === "Academy" || selectedEdu === "Seminar" || selectedEdu === "SD & Sederajat" || selectedEdu === "SMP & Sederajat") {
                                        majorField.val('m00').trigger("change");
                                        majorField.prop("disabled", true);
                                    } else {
                                        majorField.val(null).trigger("change");
                                        majorField.prop("disabled", false);
                                    }
                                });

                                $("#othersedus").on("change", function () {
                                    let collegeField = $("#collageedit");

                                    if (this.checked) {
                                        collegeField.val(null).trigger("change");
                                        collegeField.prop("disabled", true);
                                    } else {
                                        collegeField.val(null).trigger("change");
                                        collegeField.prop("disabled", false);
                                    }
                                });

                                $("#gpanumber").on("blur", function () {
                                    let gpa = $(this).val().trim();

                                    if (gpa !== "" && !gpa.includes(".")) {
                                        $(this).val(gpa + ".00");
                                    }
                                });
                            });

                        </script>


                        <script>
                            function previewFile() {
                                var file = document.getElementById("certificate").files[0];
                                var previewContainer = document.getElementById("filePreviews");

                                if (file) {
                                    var fileName = file.name;
                                    var fileType = file.type;

                                    // Show file name
                                    previewContainer.innerHTML = "<strong>Selected file:</strong> " + fileName;

                                    // Display icon based on file type
                                    var icon = "";
                                    if (fileType.includes("pdf")) {
                                        icon = "<i class='fa fa-file-pdf' style='font-size: 24px; color: #dc3545;'></i>";
                                    } else if (fileType.includes("msword") || fileType.includes("officedocument")) {
                                        icon = "<i class='fa fa-file-word' style='font-size: 24px; color: #007bff;'></i>";
                                    } else if (fileType.includes("image")) {
                                        icon = "<i class='fa fa-file-image' style='font-size: 24px; color: #28a745;'></i>";
                                    } else {
                                        icon = "<i class='fa fa-file' style='font-size: 24px; color: #6c757d;'></i>";
                                    }

                                    previewContainer.innerHTML += " " + icon;
                                }
                            }
                        </script>
@* 
                        <script>
                            function validateForm(event) {
                                let collageedit = document.getElementById("collageedit").value.trim(); 
                                let othersEdu = document.getElementById("othersedu");

                                // Reset required state in case it was previously set
                                othersEdu.removeAttribute("required");

                                // If collage is not selected and "Other" is not checked, make checkbox required
                                if (collageedit === "" && !othersEdu.checked) {
                                    othersEdu.setAttribute("required", "true");
                                    alert("Please select a college or check 'Other'.");
                                    event.preventDefault(); 
                                    return false; 
                                }

                                return true;
                            }
                        </script> *@


                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.getElementById("educationeditForm").addEventListener("submit", function (event) {
                                    event.preventDefault(); // Prevent default form submission

                                    let form = document.getElementById("educationeditForm");

                                    let isValid = true;
                                    let requiredFields = ["educationLevel", "sGraduationDates", "GraduationDates", "major", "gpanumber", "edunationalitys"];
                                    let collegeInput = document.getElementById("collageedit");
                                    let otherCollegeCheckbox = document.getElementById("othersedus");

                                    // Validate standard required fields
                                    requiredFields.forEach(function (fieldId) {
                                        let input = document.getElementById(fieldId);
                                        let select2Element = $(input).next('.select2-container'); // Get Select2 wrapper

                                        if (!input.value.trim()) {
                                            isValid = false;
                                            input.classList.add("border", "border-danger"); // Highlight normal inputs
                                            if (select2Element.length > 0) {
                                                select2Element.css("border", "1px solid red"); // Highlight Select2
                                            }
                                        } else {
                                            input.classList.remove("border", "border-danger"); // Remove highlight if valid
                                            if (select2Element.length > 0) {
                                                select2Element.css("border", ""); // Remove highlight from Select2
                                            }
                                        }
                                    });

                                    // Validate College & Other College (at least one must be selected)
                                    let collegeValid = collegeInput.value.trim() !== "";
                                    let otherCollegeValid = otherCollegeCheckbox.checked;

                                    if (!collegeValid && !otherCollegeValid) {
                                        isValid = false;
                                        $(collegeInput).next('.select2-container').css("border", "1px solid red"); // Highlight Select2
                                    } else {
                                        $(collegeInput).next('.select2-container').css("border", ""); // Remove highlight
                                    }

                                    // Show error if validation fails
                                    if (!isValid) {
                                        app.error("Please complete all required fields before proceeding.");
                                        return false;
                                    }


                                    // Check if required fields are filled
                                    if (!form.checkValidity()) {
                                        form.reportValidity(); // Show validation messages
                                        return false; // Stop submission
                                    }

                                    app.confirm("@Localizer["Are you sure you want to update education details?"]", function (d) {
                                        if (d.value) {
                                        // Collect form data
                                        var educationData = {
                                            Noreg: $('#NoregEDU').val(),
                                            EducationLevel: $('#educationLevel').val(),
                                            Collage: $('#collageedit').val(),
                                            Other: $('#othersedus').prop('checked'),
                                                StartEducationDate: $('#sGraduationDates').data('kendoDatePicker').value() ?
                                                    kendo.toString($('#sGraduationDates').data('kendoDatePicker').value(), "yyyy/MM/dd") : '',
                                                GraduationDate: $('#GraduationDates').data('kendoDatePicker').value() ?
                                                    kendo.toString($('#GraduationDates').data('kendoDatePicker').value(), "yyyy/MM/dd") : '',
                                            Major: $('#major').val(),
                                            Country: $('#edunationalitys').val(),
                                            GPA: String($('#gpanumber').val()),
                                            Id: $('#IdEdu').val()
                                        };

                                        // API URL
                                        var url = '@Url.Content("~/api/employe-profile/updateeducation")';

                                        // Call the API
                                        $.ajax({
                                            url: url,
                                            type: 'POST',
                                            contentType: 'application/json',
                                            data: JSON.stringify(educationData),
                                            success: function (response) {
                                                app.success("@Localizer["Education details updated successfully."]", "");
                                                $('#editModal').modal('hide'); // Close modal on success
                                                location.reload();
                                            },
                                            error: function (xhr, status, error) {
                                                app.error("@Localizer["Failed to update education details."]", "");
                                                }
                                            });
                                        }
                                    });

                                    return false; // Prevent default form submission
                                });
                            });
                        </script>



                       @*  <script>
                            const collageEdit = document.getElementById("collage");
                            const othersEdit = document.getElementById("others");

                            // Listen for changes in the college dropdown
                            collageEdit.addEventListener("change", function () {
                                if (collageEdit.value === "") {
                                    // If no college is selected, make the "Other" checkbox required
                                    othersEdit.required = true;
                                } else {
                                    // If a college is selected, remove the required condition from the checkbox
                                    othersEdit.required = false;
                                }
                            });

                            // Optional: You can also check the checkbox condition during form submission
                            const formeditedu = document.querySelector("formeditedu"); // assuming there is a form element
                            formeditedu.addEventListener("submit", function (event) {
                                if (collageEdit.value === "" && !othersEdit.checked) {
                                    // Prevent form submission if no college is selected and checkbox is not checked
                                    event.preventDefault();
                                    alert("If no college is selected, the 'Other' checkbox must be checked.");
                                }
                            });
                        </script> *@
                        <div id="Family" class="tabcontent">

                            <button type="button" class="btn btn-primary" onclick='familyViewModal()' style="float:right;" @(isTerminated ? "disabled" : "")>
                                <i class="fa fa-plus"></i> Add Family
                            </button>
                            <br />
                            <br />
                            <script type="text/javascript">
                                $(document).ready(function () {
                                    // Function to open the modal
                                    window.familyViewModal = function () {
                                        // Corrected ID selector
                                        $('#familyView').modal('show');
                                    };
                                });

                            </script>

                            <!-- Modal Structure -->
                            <div class="modal fade" id="familyView" tabindex="-1" aria-hidden="true" role="dialog">
                                <div class="modal-dialog modal-custom-size" style="max-width:850px;">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="FamilyViewadd">Add Family Registration</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>

                                        <div class="modal-body">
                                            <form id="familyaddForms" method="post" enctype="multipart/form-data">
                                                <div class="card-content">
                                                    <div class="card-body">
                                                        <div class="row">

                                                            <!-- Left Column -->
                                                            <div class="col-md-6 col-sm-12">
                                                                <div class="form-group">
                                                                    <span style="color: red;">* </span><label for="familytype" class="form-label">Family Type</label>
                                                                    <select class="form-control" id="familytypes" >
                                                                        <option value="">Select Family Type</option>
                                                                        @foreach (var familyType in (IEnumerable<string>)ViewData["familyTypeList"])
                                                                        {
                                                                            <option value="@familyType">@familyType</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                                <div class="form-group name-field">
                                                                    <span style="color: red;">* </span><label for="name" class="form-label">Name</label>
                                                                    <input type="text" class="form-control" id="names" />
                                                                </div>

                                                                <div class="form-group BirthPlaces-field">
                                                                    <span style="color: red; display: none" id="birth-place-asterisk">* </span><label for="BirthPlaces" class="form-label">Place of Birth</label>
                                                                    <select id="BirthPlaces" class="form-control">
                                                                        <option value="">Select Place of Birth</option>
                                                                        @foreach (var pobList in (IEnumerable<string>)ViewData["pobLister"])
                                                                        {
                                                                            <option value="@pobList">@pobList</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                                
                                                                <div class="form-group">
                                                                    <div class="form-check">
                                                                        <input type="checkbox" class="form-check-input" id="otherss">
                                                                        <label class="form-check-label" for="otherss">Other</label>
                                                                    </div>
                                                                </div>

                                                                <input type="hidden" class="form-control" id="NoregFam" name="NoregFam" value="@ProfileData.NoReg" required>

                                                                <div class="form-group fam-field fnationality-field">
                                                                    <span style="color: red; display: none" id="">* </span><label for="nationality">Nationality</label>
                                                                    <select class="form-control" id="fnationality" name="fnationality">
                                                                        <option value="" disabled selected>Please select Nationality</option>
                                                                        @foreach (var nationality in (IEnumerable<string>)ViewData["NationalityList"])
                                                                        {
                                                                            <option value="@nationality">@nationality</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                                <div class="form-group fam-field fphone-field mb-3">
                                                                    <span style="color: red; display: none">* </span><label for="fphone" class="form-label">Phone Number</label>
                                                                    <div class="input-group">
                                                                        <div class="input-group-prepend">
                                                                            <select class="form-control" id="fphoneCode" name="fphoneCode" style="max-width: 100px;">
                                                                                @foreach (var PhoneCode in (IEnumerable<string>)ViewData["phoneList"])
                                                                                {
                                                                                    if (PhoneCode == "+62")
                                                                                    {
                                                                                        <option value="@PhoneCode" selected>@PhoneCode</option>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <option value="@PhoneCode">@PhoneCode</option>
                                                                                    }
                                                                                }
                                                                            </select>
                                                                        </div>
                                                                        <input type="text" class="form-control phone-number" id="fphone" name="fphone" />
                                                                    </div>
                                                                </div>

                                                                <div class="form-group fam-field feducationLevels-field">
                                                                    <span style="color: red; display: none">* </span><label class="form-label">Education Level</label>
                                                                    <select class="form-control" id="feducationLevels">
                                                                        <option value="" disabled selected>Please select Education</option>
                                                                        @foreach (var edulevelList in (IEnumerable<string>)ViewData["eduLevelList"])
                                                                        {
                                                                            <option value="@edulevelList">@edulevelList</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                                <div class="form-group fam-field insuranceenoo-field mb-3">
                                                                    <span style="color: red; display: none">* </span><label for="insurances" class="form-label">Insurance Number</label>
                                                                    <input type="text" class="form-control number-hyphen-only" id="insuranceenoo" />
                                                                </div>

                                                                <div class="form-group fam-field residentialStatuss-field">
                                                                    <span style="color: red; display: none">* </span><label class="form-label">Residential Status</label>
                                                                    <select class="form-control" id="residentialStatuss">
                                                                        <option value="" disabled selected>Please select Residential Status</option>
                                                                        @foreach (var residentialList in (IEnumerable<string>)ViewData["residentialList"])
                                                                        {
                                                                            <option value="@residentialList">@residentialList</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                                <div class="form-group fam-field ChildOrders-field">
                                                                    <span style="color: red;">* </span><label for="ChildOrder" class="form-label">Child Order</label>
                                                                    <select class="form-control" id="ChildOrders" hidden>
                                                                        <option value="-">-</option>
                                                                        <option value="1">1</option>
                                                                        <option value="2">2</option>
                                                                        <option value="3">3</option>
                                                                        <option value="4">4</option>
                                                                        <option value="5">5</option>
                                                                        <option value="6">6</option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <!-- Right Column -->
                                                            <div class="col-md-6 col-sm-12">

                                                                <div class="form-group">
                                                                    <span style="color: red;">* </span><label for="LifeStatus" class="form-label">Life Status</label>
                                                                    <select class="form-control" id="LifeStatus">
                                                                        <option value="-">Select Life Status</option>
                                                                        <option value="1">Alive</option>
                                                                        <option value="0">Passed Away</option>
                                                                    </select>
                                                                </div>

                                                                <div class="form-group" id="deathDateGroup" style="display: none;">
                                                                    <span style="color: red;">* </span><label for="DeathDate" class="form-label">Date of Death</label>
                                                                    @*<input type="date" class="form-control" id="DeathDate">*@
                                                                    @(Html.Kendo().DatePicker()
                                                                        .Name("DeathDate")
                                                                        .HtmlAttributes(new
                                                                        {
                                                                            id = "DeathDate",
                                                                            @class = "form-control"
                                                                        })
                                                                        .Value(ViewData["deathDate"] != null && !string.IsNullOrEmpty(ViewData["deathDate"].ToString())
                                                                        ? Convert.ToDateTime(ViewData["deathDate"])
                                                                        : (DateTime?)null)
                                                                        .Format("dd/MM/yyyy")
                                                                        .Deferred()
                                                                        )
                                                                </div>

                                                                <div class="form-group">
                                                                    <span style="color: red;">* </span><label class="form-label">Gender</label>
                                                                    <div style="margin-top: 6px">
                                                                        <input type="radio" name="gender" id="male" value="Laki - Laki" style="height:15px; width:15px; vertical-align: middle; margin-bottom:4px;">
                                                                        <label for="male" style="margin-left:4px;">Male</label>
                                                                        <span style="margin-left:17px;"></span>
                                                                        <input type="radio" name="gender" id="female" value="Perempuan" style="height:15px; width:15px; vertical-align: middle; margin-bottom:4px;">
                                                                        <label for="female" style="margin-left:4px;">Female</label>
                                                                    </div>
                                                                </div>

                                                                <div class="form-group BirthDates-field">
                                                                    <span style="color: red; display: none" id="birth-date-asterisk">* </span><label for="BirthDate" class="form-label">Date of Birth</label>
                                                                    @*<input type="date" class="form-control" id="BirthDates">*@
                                                                    @(Html.Kendo().DatePicker()
                                                                        .Name("BirthDates")
                                                                        .HtmlAttributes(new
                                                                        {
                                                                            id = "BirthDates",
                                                                            @class = "form-control"
                                                                        })
                                                                        .Value(ViewData["birthDate"] != null && !string.IsNullOrEmpty(ViewData["birthDate"].ToString())
                                                                        ? Convert.ToDateTime(ViewData["birthDate"])
                                                                        : (DateTime?)null)
                                                                        .Format("dd/MM/yyyy")
                                                                        .Deferred()
                                                                        )
                                                                </div>

                                                                <div class="form-group fam-field freligion-field">
                                                                    <span style="color: red; display: none" id="spanprofiles">* </span><label for="religion">Religion</label>
                                                                    <select class="form-control" id="freligion" name="fReligion">
                                                                        <option value="" disabled selected>Please select Religion</option>
                                                                        @foreach (var religionList in (IEnumerable<string>)ViewData["religionList"])
                                                                        {
                                                                            <option value="@religionList">@religionList</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                                <div class="form-group fam-field niks-field">
                                                                    <span style="color: red; display: none">* </span><label for="niks" class="form-label">NIK</label>
                                                                    <input type="text" class="form-control strict-number" id="niks" />
                                                                </div>

                                                                <div class="form-group fam-field fdomicile-field mb-3">
                                                                    <span style="color: red; display: none">* </span><label for="domicile" class="form-label">Domicile Address</label>
                                                                    <input type="text" class="form-control" id="fdomicile" />
                                                                </div>

                                                                <div class="form-group fam-field fjob-field mb-3">
                                                                    <span style="color: red; display: none">* </span><label for="fjob" class="form-label">Job</label>
                                                                    <input type="text" class="form-control" id="fjob" />
                                                                </div>

                                                                <div class="form-group fam-field bpjshealths-field mb-3">
                                                                    <span style="color: red; display: none">* </span><label for="bpjs" class="form-label">BPJS Health</label>
                                                                    <input type="text" class="form-control strict-bpjs" id="bpjshealths" />
                                                                </div>
                                                            </div>

                                                        </div> <!-- end row -->
                                                    </div> <!-- end card-body -->
                                                </div> <!-- end card-content -->

                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    <button type="submit" class="btn btn-primary">Save</button>
                                                </div>
                                            </form>
                                        </div> <!-- end modal-body -->
                                    </div> <!-- end modal-content -->
                                </div> <!-- end modal-dialog -->
                            </div> <!-- end modal -->

                            @*Show or hide "Date of Death", and mandatory or non-mandatory of "Place of Birth" and "Date of Birth" based on Life Status*@
                            <script>
                                $(document).ready(function () {
                                    $('#LifeStatus').on('change', function () {
                                        const lifeStatus = $(this).val();
                                        console.log("LIFE: ", lifeStatus);
                                        
                                        if (lifeStatus === '0') { // 0 = Off/Dead, 1 = On/Alive
                                            $('#deathDateGroup').show();
                                            //$('#DeathDate').attr('required', true);
                                            //$("#birth-place-asterisk").css("display", "none");
                                            //$("#birth-date-asterisk").css("display", "none");
                                        } else {
                                            $('#deathDateGroup').hide();
                                            $('#DeathDate').val('');
                                            //$('#DeathDate').val('').removeAttr('required');
                                            //$("#birth-place-asterisk").css("display", "inline");
                                            //$("#birth-date-asterisk").css("display", "inline");
                                        }
                                    });
                                });
                            </script>

                            @*Initialize Select2 for both dropdowns inside the modal after element shown*@
                            <script>
                                $(document).ready(function () {
                                    $('#familyView').on('shown.bs.modal', function () {
                                        $('#familytypes, #BirthPlaces, #fnationality, #freligion, #feducationLevels').select2({
                                            dropdownParent: $('#familyView'),
                                            width: '100%' 
                                        });
                                    });
                                });
                            </script>

                            @*Disable Place of Birth if Other checked*@
                            <script>
                                $(document).ready(function () {
                                   
                                    $("#otherss").on("change", function () {
                                        let dobField = $("#BirthPlaces");

                                        dobField.val(null).trigger("change");

                                        if (this.checked) {
                                            dobField.prop("disabled", true);
                                        } else {
                                            dobField.prop("disabled", false);
                                        }
                                    });
                                });

                            </script>

                            <script>
                            
                                document.addEventListener("DOMContentLoaded", function () {
                                    document.getElementById("familyaddForms").addEventListener("submit", function (event) {
                                        event.preventDefault();

                                        let form = document.getElementById("familyaddForms");
                                        let isValid = true;
                                        let missingFields = [];
                                        var LifeStatus = parseInt($('#LifeStatus').val());

                                        const selectedFamilyType = document.getElementById("familytypes").value;
                                        //console.log("TYPE: ",selectedFamilyType);
                                        //const dynamicRequiredFields = familyTypeFields[selectedFamilyType] || [];
                                        const dynamicRequiredFields = ['familytypes', 'names', 'LifeStatus', 'gender'];
                                         // if (LifeStatus === 1) {
                                         //     dynamicRequiredFields.push('BirthPlaces', 'BirthDates');
                                         // }

                                        // Error required border
                                        dynamicRequiredFields.forEach(function (fieldId) {
                                            let input = document.getElementById(fieldId);
                                            //console.log("FIELD: ", input);
                                            if (!input) return; // skip if input not found

                                            let select2Element = $(input).next('.select2-container');
                                            let value = input.value?.trim();

                                            if (!input.disabled && $(input).is(":visible") && (!value || value === "" || value === "-")) {
                                                isValid = false;
                                                input.classList.add("border", "border-danger");
                                                if (select2Element.length > 0) {
                                                    select2Element.css({
                                                        "border": "1px solid red",
                                                        "border-radius": "4px"
                                                    });
                                                }
                                            } else {
                                                input.classList.remove("border", "border-danger");
                                                if (select2Element.length > 0) {
                                                    select2Element.css({
                                                        "border": "",
                                                        "border-radius": "4px"
                                                    });
                                                }
                                            }
                                        });

                                        // [MODIFIED] Gender field handled only if required
                                        if (dynamicRequiredFields.includes("gender")) {
                                            let genderChecked = $("input[name='gender']:checked").length > 0;
                                            if (!genderChecked) {
                                                isValid = false;
                                                $("input[name='gender']").each(function () {
                                                    $("label[for='" + $(this).attr("id") + "']").css({
                                                        "border": "1px solid red",
                                                        "padding": "0px 6px",
                                                        "display": "inline-block",
                                                        "border-radius": "4px"
                                                    });
                                                });
                                            } else {
                                                $("input[name='gender']").each(function () {
                                                    $("label[for='" + $(this).attr("id") + "']").css({
                                                        "border": "",
                                                        "padding": "",
                                                        "display": "",
                                                        "border-radius": ""
                                                    });
                                                });
                                            }
                                        }

                                        // [MODIFIED] BirthPlace or Other logic only if BirthPlaces is required
                                        if (dynamicRequiredFields.includes("BirthPlaces")) {
                                            let birthInput = $("#BirthPlaces");
                                            let otherFam = document.getElementById("otherss");

                                            let birthValid = birthInput.val()?.trim() !== "";
                                            let otherFamValid = otherFam.checked;

                                            if (!birthValid && !otherFamValid) {
                                                isValid = false;
                                                birthInput.next('.select2-container').css("border", "1px solid red");
                                            } else {
                                                birthInput.next('.select2-container').css("border", "");
                                            }
                                        }

                                        if (!isValid) {
                                            app.error("Please complete all required fields before proceeding.");
                                            return false;
                                        }

                                        if (!form.checkValidity()) {
                                            form.reportValidity();
                                            return false;
                                        }

                                        var familyData = {
                                            Noreg: $('#NoregFam').val(),
                                            Name: $('#names').val(),
                                            Gender: $('input[name="gender"]:checked').val(),
                                            BirthPlace: $('#BirthPlaces').val()?.trim(),
                                            Other: $('#otherss').prop('checked'),
                                            BirthDate: $('#BirthDates').data('kendoDatePicker').value() ?
                                                kendo.toString($('#BirthDates').data('kendoDatePicker').value(), "yyyy/MM/dd") : null,
                                            Bpjs: $('#bpjshealths').val(),
                                            InsuranceNumber: $('#insuranceenoo').val(),
                                            FamilyType: $('#familytypes').val(),
                                            Nik: $('#niks').val(),
                                            //PhoneNumber: $('#fphoneCode').val() + ' ' + $('#fphone').val(),
                                            PhoneNumber: $('#fphone').val() ? ($('#fphoneCode').val() + ' ' + $('#fphone').val()) : '',
                                            Job: $('#fjob').val(),
                                            LifeStatus: parseInt($('#LifeStatus').val()),
                                            DeathDate: $('#DeathDate').data('kendoDatePicker').value() ?
                                                kendo.toString($('#DeathDate').data('kendoDatePicker').value(), "yyyy/MM/dd") : null,
                                            Religion: $('#freligion').val(),
                                            Nationality: $('#fnationality').val(),
                                            EducationLevel: $('#feducationLevels').val(),
                                            Domicile: $('#fdomicile').val(),
                                            AddressStatusCode: $('#residentialStatuss').val(),
                                        };
                                        console.log("status: ",familyData);

                                        var url = '@Url.Content("~/api/employe-profile/addfamilymember")';

                                        $.ajax({
                                            url: url,
                                            type: 'POST',
                                            contentType: 'application/json',
                                            data: JSON.stringify(familyData),
                                            success: function (response) {
                                                app.success("@Localizer["Family Data added successfully."]", "");
                                                location.reload();
                                            },
                                            error: function (xhr, status, error) {
                                                console.log("Status: ", status);
                                                console.log("Error: ", error);
                                                console.log("Response Text: ", xhr.responseText);
                                                app.error("@Localizer["Failed to added Family data details."]", "");
                                            }
                                        });
                                    });
                                });

                            </script>

                            @(
                                Html.Kendo().Grid(famData)
                                .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                .Name("familyGrid")
                                .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                .Pageable(options =>
                                {
                                    options.Input(true);
                                    options.Numeric(false);
                                    options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                })
                                .Scrollable(s => s.Enabled(true).Height("auto"))
                                .Resizable(resizable => resizable.Columns(true))
                                .Columns(columns =>
                                {
                                    columns.Bound(x => x.FamilyTypeCode).Title("Family Type").ClientTemplate(@"<text>
                            #: FamilyTypeCode == 'Pasangan' && GenderCode== 'Perempuan' ? 'Istri' : FamilyTypeCode == 'Pasangan' && GenderCode== 'Laki - Laki' ? 'Suami' : FamilyTypeCode#
                            </text>
                            ").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.Name).Title("Name").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.Nationality).Title("Nationality").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.NIK).Title("Identity Number / KTP Number").HtmlAttributes(new { @class = "text-center" }).Width(180);
                                    columns.Bound(x => x.BirthPlace).Title("Birth Place").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.BirthDate).Title("Birth Date").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.GenderCode).Title("Gender").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.LifeStatus).Title("Life Status").ClientTemplate("#= LifeStatus == 1 ? 'Alive' : LifeStatus == 0 ? 'Passed Away' : '-' #").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.DeathDate)
                                    .Title("Date of Death")
                                    .ClientTemplate("#= LifeStatus == 0 && DeathDate ? kendo.toString(kendo.parseDate(DeathDate), 'dd/MM/yyyy') : '-' #")
                                    .HtmlAttributes(new { @class = "text-center" })
                                    .Width(150);
                                    columns.Bound(x => x.Religion).Title("Religion").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.ChildOrder).Title("Child Order").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.ChildStatus).Title("Child Status").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.Domicile).Title("Domicile").HtmlAttributes(new { @class = "text-center" }).Width(200);
                                    columns.Bound(x => x.AddressStatusCode).Title("Address Status").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.PhoneNumber).Title("Phone").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.EducationLevel).Title("Education").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.Job).Title("Job").HtmlAttributes(new { @class = "text-center" }).Width(150);
                            //         columns.Bound(x => x.FamilyTypeCode).Title("Child").ClientTemplate(@"<text>
                            // #= FamilyTypeCode == 'Anak Kandung' || FamilyTypeCode == 'Anak Angkat' ? BindAnak(): '-'#
                            // </text>").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.BpjsNumber).Title("BPJS Health").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.InsuranceNumber).Title("Insurance Number").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    //columns.Bound(x => x.DeathDate).Title("Death Date").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(150);
                                    columns.Bound(x => x.FamilyTypeCode)
                                    .Title("Action")
                                    .ClientTemplate(@"
                            <div style='display:flex; gap: 5px; justify-content: center; align-items: center;'>
                            <button class='btn btn-link p-1' onclick='EditFamilyModal(""#= FamilyTypeCode #"", ""#= Name #"", ""#= BirthPlace #"", ""#= kendo.toString(BirthDate, ""yyyy-MM-dd"") #"", ""#= GenderCode #"", ""#= BpjsNumber #"", ""#= InsuranceNumber #"", ""#= LifeStatus #"", ""#= kendo.toString(DeathDate, ""yyyy-MM-dd"") #"", ""#= EducationLevel #"", ""#= Job #"", ""#= PhoneNumber #"", ""#= ChildStatus #"", ""#= AddressStatusCode #"", ""#= NIK #"", ""#= Domicile #"", ""#= Religion #"", ""#= Nationality #"" ,""#= Id #"" )'>
                            <i class='fa fa-pencil'></i>
                            </button>
                            <button class='btn btn-link p-1' onclick='deleteConfirmation(""#= Id #"")'>
                            <i class='fa fa-trash text-danger'></i>
                            </button>
                            </div>
                            ")
                                    .HtmlAttributes(new { @class = "text-center" })
                                    .Width(100);

                                })
                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No personal development found"].Value + "</div>"))
                                .Deferred()
                                )
                        </div>
                    @*     <script type="text/javascript">
                            // Ensure the function is defined after the document is ready
                            $(document).ready(function () {
                                // Function to open the modal for editing
                                window.EditFamilyModal = function () {
                                    // Open the modal
                                    $('#FamilyModal').modal('show');
                                };
                            });
                        </script> *@

                        <script>
                            function deleteConfirmation(id) {
                                Swal.fire({
                                    title: 'Are you sure?',
                                    text: "You won't be able to revert this!",
                                    type: 'warning',
                                    showCancelButton: true,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Yes, delete it!'
                                }).then((result) => {
                                    if (result.value) {
                                        //console.log("hereL ",id);
                                        deleteFamilyData(id);
                                    }
                                });
                            }

                            function deleteFamilyData(id) {
                                var url = '@Url.Content("~/api/employe-profile/deletefamilymember")';

                                var model = {
                                    Id: id
                                };
                                //console.log("test: ", id);

                                $.ajax({
                                    url: url,
                                    type: 'POST',
                                    contentType: 'application/json',
                                    data: JSON.stringify(model),
                                    success: function (response) {
                                        if (response.success) {
                                            Swal.fire(
                                                'Deleted!',
                                                response.message,
                                                'success'
                                            );
                                            location.reload();
                                        } else {
                                            Swal.fire(
                                                'Error!',
                                                response.message,
                                                'error'
                                            );
                                        }
                                    },
                                    error: function (xhr, status, error) {
                                        var errorMessage = "An unexpected error occurred.";
                                        if (xhr.responseJSON && xhr.responseJSON.message) {
                                            errorMessage = xhr.responseJSON.message;
                                        }
                                        Swal.fire(
                                            'Error!',
                                            errorMessage,
                                            'error'
                                        );
                                    }
                                });
                            }
                        </script>

                        <script>
                            // Make sure the function is accessible globally
                            function EditFamilyModal(FamilyTypeCode, Name, BirthPlace, BirthDate, GenderCode, BpjsNumber, InsuranceNumber, LifeStatus, DeathDate, Education, Job, PhoneNumber, ChildStatus, AddressStatus, NIK, Domicile, Religion, Nationality, Id) {

                                // Helper to prevent null/undefined
                                const safe = (val) => (val && val !== 'null') ? val : '';

                                // Set FamilyType dropdown
                                $('#familytype').val(safe(FamilyTypeCode));
                                updateEditFamFormFields(FamilyTypeCode);

                                console.log("POB: ", BirthPlace);
                                $('#BirthPlace').val(safe(BirthPlace).trim()).trigger('change');
                                //$('#BirthDate').val(safe(BirthDate));
                                var birthDatePicker = $("#BirthDate").data("kendoDatePicker");
                                if (birthDatePicker && safe(BirthDate)) {
                                    birthDatePicker.value(new Date(safe(BirthDate)));
                                }

                                if (GenderCode === "Laki - Laki") {
                                    $("input[name='genders'][value='Laki - Laki']").prop("checked", true);
                                } else if (GenderCode === "Perempuan") {
                                    $("input[name='genders'][value='Perempuan']").prop("checked", true);
                                }

                                $('#name').val(safe(Name));
                                $('#idfamily').val(safe(Id));
                                $('#insurancenumber').val(safe(InsuranceNumber));
                                $('#bpjshealth').val(safe(BpjsNumber));

                                var ftype = (FamilyTypeCode === 'Anak Kandung' || FamilyTypeCode === 'Anak Angkat') ? BindAnak() : '-';
                                $('#ChildOrder').val(safe(ftype));

                                $('#efLifeStatus').val(safe(LifeStatus)).trigger('change');
                                //$('#efDeathDate').val(safe(DeathDate));
                                var deathDatePicker = $("#efDeathDate").data("kendoDatePicker");
                                if (deathDatePicker && safe(DeathDate)) {
                                    deathDatePicker.value(new Date(safe(DeathDate)));
                                }

                                $('#efeducationLevels').val(safe(Education)).trigger('change');
                                $('#efjob').val(safe(Job));

                                    // var fullPhone = safe(PhoneNumber).replace(/\s+/g, '');

                                    // var match = fullPhone.match(/^\+\d{1,4}/);
                                    // var selectedCode = match ? match[0] : "+62";
                                    // var phoneWithoutCode = fullPhone.replace(selectedCode, '');
                                    // console.log("param:", PhoneNumber);
                                    // console.log("phonenum:", phoneWithoutCode);
                                    // console.log("efcode:", selectedCode);

                                var fullPhone = safe(PhoneNumber).trim();
                                var parts = fullPhone.split(' ');

                                // Cek apakah parts[0] merupakan kode negara yang valid (diawali dengan '+')
                                var selectedCode = (parts[0] && parts[0].startsWith('+')) ? parts[0] : "+62";
                                var phoneWithoutCode = (parts[0] && parts[0].startsWith('+')) ? parts.slice(1).join(' ') : fullPhone;

                                console.log("param:", PhoneNumber);
                                console.log("phonenum:", phoneWithoutCode);
                                console.log("efcode:", selectedCode);

                                $('#efphoneCode').val(selectedCode).trigger('change');
                                $('#efphone').val(phoneWithoutCode);
                                //$('#efphone').val(safe(PhoneNumber));
                                // $('#efChildStatus').val(safe(ChildStatus));
                                $('#efresidentialStatus').val(safe(AddressStatus)).trigger('change');
                                $('#eniks').val(safe(NIK));
                                $('#efdomicile').val(safe(Domicile));
                                $('#efreligion').val(safe(Religion)).trigger('change');
                                $('#efnationality').val(safe(Nationality)).trigger('change');

                                $('#FamilyModal').modal('show');
                            }

                        </script>

                        <!-- Modal HTML -->
                        <div class="modal fade" id="FamilyModal" tabindex="-1" aria-hidden="true" role="dialog">
                            <div class="modal-dialog modal-custom-size" style="max-width:850px;">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="FamilyViewadd">Edit Family Registration</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>

                                    <div class="modal-body">
                                        <form id="familyeditForm" method="post" enctype="multipart/form-data">
                                            <div class="card-content">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <!-- Left Column -->
                                                        <div class="col-md-6 col-sm-12">
                                                            <div class="form-group">
                                                                <span style="color: red;">* </span><label for="familytype" class="form-label">Family Type</label>
                                                                <select class="form-control" id="familytype">
                                                                    @foreach (var familyType in (IEnumerable<string>)ViewData["familyTypeList"])
                                                                    {
                                                                        <option value="@familyType">@familyType</option>
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="form-group">
                                                                <span style="color: red;">* </span><label for="name" class="form-label">Name</label>
                                                                <input type="text" class="form-control" id="name" />
                                                            </div>
                                                            
                                                            <input type="text" class="form-control" id="idfamily" required hidden />
                                                            <input type="text" class="form-control" id="noregfamily" value="@ProfileData.NoReg" required hidden />

                                                            <div class="form-group">
                                                                <span style="color: red; display: none" id="birth-place-asterisks">* </span><label for="BirthPlace" class="form-label">Place of Birth</label>
                                                                <select class="form-control" id="BirthPlace">
                                                                    <option value="">Please select Place of Birth</option>
                                                                    @foreach (var BirthPlace in (IEnumerable<string>)ViewData["pobLister"])
                                                                    {
                                                                        <option value="@BirthPlace">@BirthPlace</option>
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="form-group">
                                                                <div class="form-check">
                                                                    <input type="checkbox" class="form-check-input" id="othersfam">
                                                                    <label class="form-check-label" for="othersfam">Other</label>
                                                                </div>
                                                            </div>

                                                            <div class="form-group fam-field efnationality-field">
                                                                <span style="color: red; display: none" id="spanprofiles">* </span><label for="nationality">Nationality</label>
                                                                <select class="form-control" id="efnationality" name="fnationality" data-default-value="@Html.Encode(ViewData["Nationality"])">
                                                                    @foreach (var nationality in (IEnumerable<string>)ViewData["NationalityList"])
                                                                    {
                                                                        var nationalityValue = Html.Encode(ViewData["Nationality"]);
                                                                        if (nationality.Contains(nationalityValue))
                                                                        {
                                                                            <option value="@nationality" selected>@nationality</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value="@nationality">@nationality</option>
                                                                        }
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="form-group fam-field efphone-field mb-3">
                                                                <span style="color: red; display: none">* </span><label for="efphone" class="form-label">Phone Number</label>
                                                                <div class="input-group">
                                                                    <div class="input-group-prepend">
                                                                        <select class="form-control" id="efphoneCode" name="efphoneCode" style="max-width: 100px;">
                                                                            @foreach (var PhoneCode in (IEnumerable<string>)ViewData["phoneList"])
                                                                            {
                                                                                <option value="@PhoneCode">@PhoneCode</option>
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                    <input type="text" class="form-control phone-number" id="efphone" name="efphone" />
                                                                </div>
                                                            </div>

                                                            <div class="form-group fam-field efeducationLevels-field">
                                                                <span style="color: red; display: none">* </span><label class="form-label">Education Level</label>
                                                                <select class="form-control" id="efeducationLevels">
                                                                    <option value="" disabled selected>Please select Education</option>
                                                                    @foreach (var edulevelList in (IEnumerable<string>)ViewData["eduLevelList"])
                                                                    {
                                                                        <option value="@edulevelList">@edulevelList</option>
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="mb-3 fam-field insurancenumber-field">
                                                                <span style="color: red; display: none">* </span><label for="insurance" class="form-label">Insurance Number</label>
                                                                <input type="text" class="form-control number-hyphen-only" id="insurancenumber" />
                                                            </div>

                                                            

                                                            <div class="form-group fam-field efresidentialStatus-field">
                                                                <span style="color: red; display: none">* </span><label class="form-label">Residential Status</label>
                                                                <select class="form-control" id="efresidentialStatus">
                                                                    <option value="" disabled selected>Please select Residential Status</option>
                                                                    @foreach (var residentialList in (IEnumerable<string>)ViewData["residentialList"])
                                                                    {
                                                                        <option value="@residentialList">@residentialList</option>
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="form-group fam-field">
                                                                <span style="color: red;">* </span><label for="ChildOrder" class="form-label">Child Order</label>
                                                                <select class="form-control" id="ChildOrder" hidden>
                                                                    <option value="-">-</option>
                                                                    <option value="1">1</option>
                                                                    <option value="2">2</option>
                                                                    <option value="3">3</option>
                                                                    <option value="4">4</option>
                                                                    <option value="5">5</option>
                                                                    <option value="6">6</option>
                                                                </select>
                                                            </div>
                                                        </div>

                                                        <!-- Right Column -->
                                                        <div class="col-md-6 col-sm-12">

                                                            <div class="form-group">
                                                                <span style="color: red;">* </span><label for="LifeStatus" class="form-label">Life Status</label>
                                                                <select class="form-control" id="efLifeStatus">
                                                                    <option value="-">Select Life Status</option>
                                                                    <option value="1">Alive</option>
                                                                    <option value="0">Passed Away</option>
                                                                </select>
                                                            </div>

                                                            <div class="form-group" id="efdeathDateGroup" style="display: none;">
                                                                <span style="color: red;">* </span><label for="DeathDate" class="form-label">Date of Death</label>
                                                                @*<input type="date" class="form-control" id="efDeathDate">*@
                                                                @(Html.Kendo().DatePicker()
                                                                    .Name("DeathDate")
                                                                    .HtmlAttributes(new
                                                                    {
                                                                        id = "efDeathDate",
                                                                        @class = "form-control"
                                                                    })
                                                                    .Value(ViewData["deathDate"] != null && !string.IsNullOrEmpty(ViewData["deathDate"].ToString())
                                                                    ? Convert.ToDateTime(ViewData["deathDate"])
                                                                    : (DateTime?)null)
                                                                    .Format("dd/MM/yyyy")
                                                                    .Deferred()
                                                                    )
                                                            </div>

                                                            <div class="form-group">
                                                                <span style="color: red;">* </span><label class="form-label">Gender</label>
                                                                <div style="margin-top: 6px">
                                                                    <input type="radio" name="genders" id="males" value="Laki - Laki" style="height:15px; width:15px;">
                                                                    <label for="males">Male</label>
                                                                    <span style="margin-left:17px;"></span>
                                                                    <input type="radio" name="genders" id="females" value="Perempuan" style="height:15px; width:15px;">
                                                                    <label for="females">Female</label>
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                <span style="color: red; display: none" id="birth-date-asterisks">* </span><label for="BirthDate" class="form-label">Date of Birth</label>
                                                                @*<input type="date" class="form-control" id="BirthDate">*@
                                                                @(Html.Kendo().DatePicker()
                                                                    .Name("BirthDate")
                                                                    .HtmlAttributes(new
                                                                    {
                                                                        id = "BirthDate",
                                                                        @class = "form-control"
                                                                    })
                                                                    .Value(ViewData["birthDate"] != null && !string.IsNullOrEmpty(ViewData["birthDate"].ToString())
                                                                    ? Convert.ToDateTime(ViewData["birthDate"])
                                                                    : (DateTime?)null)
                                                                    .Format("dd/MM/yyyy")
                                                                    .Deferred()
                                                                    )
                                                            </div>

                                                            <div class="form-group fam-field efreligion-field">
                                                                <span style="color: red; display: none" id="spanprofiles">* </span><label for="religion">Religion</label>
                                                                <select class="form-control" id="efreligion" name="fReligion" data-default-value="@ViewData["Religion"]?.ToString()">
                                                                    @foreach (var religionList in (IEnumerable<string>)ViewData["religionList"])
                                                                    {
                                                                        if (!string.IsNullOrEmpty(religionList) && religionList.Contains(ViewData["Religion"]?.ToString()))
                                                                        {
                                                                            <option value="@religionList" selected>@religionList</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value="@religionList">@religionList</option>
                                                                        }
                                                                    }
                                                                </select>
                                                            </div>

                                                            <div class="form-group fam-field eniks-field">
                                                                <span style="color: red; display: none">* </span><label for="eniks" class="form-label">NIK</label>
                                                                <input type="text" class="form-control strict-number" id="eniks" />
                                                            </div>

                                                            <div class="form-group fam-field efdomicile-field mb-3">
                                                                <span style="color: red; display: none">* </span><label for="efdomicile" class="form-label">Domicile Address</label>
                                                                <input type="text" class="form-control" id="efdomicile" />
                                                            </div>

                                                            <div class="form-group fam-field efjob-field mb-3">
                                                                <span style="color: red; display: none">* </span><label for="efjob" class="form-label">Job</label>
                                                                <input type="text" class="form-control" id="efjob" />
                                                            </div>

                                                            <div class="mb-3 fam-field bpjshealth-field">
                                                                <span style="color: red; display: none">* </span><label for="bpjs" class="form-label">BPJS Health</label>
                                                                <input type="text" class="form-control strict-bpjs" id="bpjshealth" />
                                                            </div>

                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Modal Footer -->
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                <button type="submit" id="editfamillyButton" class="btn btn-primary">Save</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            $(document).ready(function () {
                                $('#efLifeStatus').on('change', function () {
                                    const lifeStatus = $(this).val();
                                    console.log("efLIFE: ", lifeStatus);

                                    if (lifeStatus === '0') { // 0 = Dead
                                        $('#efdeathDateGroup').show();
                                        //$('#efDeathDate').attr('required', true);
                                        //$("#birth-place-asterisks").css("display", "none");
                                        //$("#birth-date-asterisks").css("display", "none");
                                    } else {
                                        $('#efdeathDateGroup').hide();
                                        //$('#efDeathDate').val('');
                                        //$('#efDeathDate').val('').removeAttr('required');
                                        //$("#birth-place-asterisks").css("display", "inline");
                                        //$("#birth-date-asterisks").css("display", "inline");
                                    }
                                });
                            });
                        </script>

                          <script>
                            $(document).ready(function () {
                                $('#FamilyModal').on('shown.bs.modal', function () {
                                    // Initialize Select2 for both dropdowns inside the modal
                                    $('#familytype, #BirthPlace, #efnationality, #efeducationLevels, #efreligion').select2({
                                        dropdownParent: $('#FamilyModal'),
                                        width: '100%' 
                                    });
                                });
                            });
                        </script>

                     
                        <script>
                            $(document).ready(function () {
                                // Toggle BirthPlace based on "othersfam" checkbox
                                $("#othersfam").on("change", function () {
                                    let dobField = $("#BirthPlace");

                                    dobField.val(null).trigger("change");

                                    if (this.checked) {
                                        dobField.prop("disabled", true);
                                    } else {
                                        dobField.prop("disabled", false);
                                    }
                                });
                            });
                        </script>

                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.getElementById("familyeditForm").addEventListener("submit", function (event) {
                                    event.preventDefault();

                                    let form = document.getElementById("familyeditForm");
                                    let isValid = true;
                                    var LifeStatus = parseInt($('#efLifeStatus').val());

                                    const selectedFamilyType = document.getElementById("familytype").value;
                                    //const dynamicRequiredFields = editFamilyTypeFields[selectedFamilyType] || [];
                                    const dynamicRequiredFields = ['familyType', 'name', 'efLifeStatus', 'gender'];
                                    // if (LifeStatus === 1) {
                                    //     dynamicRequiredFields.push('BirthPlace', 'BirthDate');
                                    // }

                                    dynamicRequiredFields.forEach(function (fieldId) {
                                        let input = document.getElementById(fieldId);
                                        if (!input) return;

                                        let select2Element = $(input).next('.select2-container');
                                        let value = input.value?.trim();

                                        if (!input.disabled && $(input).is(":visible") && (!value || value === "" || value === "-")) {
                                            isValid = false;
                                            input.classList.add("border", "border-danger");
                                            if (select2Element.length > 0) {
                                                select2Element.css({
                                                    "border": "1px solid red",
                                                    "border-radius": "4px"
                                                });
                                            }
                                        } else {
                                            input.classList.remove("border", "border-danger");
                                            if (select2Element.length > 0) {
                                                select2Element.css({
                                                    "border": "",
                                                    "border-radius": "4px"
                                                });
                                            }
                                        }
                                    });

                                    if (dynamicRequiredFields.includes("gender")) {
                                        let genderChecked = $("input[name='genders']:checked").length > 0;
                                        if (!genderChecked) {
                                            isValid = false;
                                            $("input[name='genders']").each(function () {
                                                $("label[for='" + $(this).attr("id") + "']").css({
                                                    "border": "1px solid red",
                                                    "padding": "0px 6px",
                                                    "display": "inline-block",
                                                    "border-radius": "4px"
                                                });
                                            });
                                        } else {
                                            $("input[name='genders']").each(function () {
                                                $("label[for='" + $(this).attr("id") + "']").css({
                                                    "border": "",
                                                    "padding": "",
                                                    "display": "",
                                                    "border-radius": ""
                                                });
                                            });
                                        }
                                    }

                                    if (dynamicRequiredFields.includes("BirthPlaces")) {
                                        let birthInput = $("#BirthPlace");
                                        let otherFam = document.getElementById("othersfam");

                                        let birthValid = birthInput.val()?.trim() !== "";
                                        let otherFamValid = otherFam.checked;

                                        if (!birthValid && !otherFamValid) {
                                            isValid = false;
                                            birthInput.next('.select2-container').css("border", "1px solid red");
                                        } else {
                                            birthInput.next('.select2-container').css("border", "");
                                        }
                                    }

                                    if (!isValid) {
                                        console.log("LIST yahng harus ISI: ",dynamicRequiredFields)
                                        app.error("Please complete all required fields before proceeding.");
                                        return false;
                                    }

                                    if (!form.checkValidity()) {
                                        form.reportValidity();
                                        return false;
                                    }

                                    app.confirm("@Localizer["Are you sure you want to update family details?"]", function (d) {
                                        if (d.value) {
                                            var familyDataedit = {
                                                Id: $('#idfamily').val(),
                                                Name: $('#name').val(),
                                                Gender: $('input[name="genders"]:checked').val(),
                                                BirthPlace: $('#BirthPlace').val()?.trim(),
                                                Other: $('#othersfam').prop('checked'),
                                                BirthDate: $('#BirthDate').data('kendoDatePicker').value() ?
                                                    kendo.toString($('#BirthDate').data('kendoDatePicker').value(), "yyyy/MM/dd") : null,
                                                Bpjs: $('#bpjshealth').val(), 
                                                InsuranceNumber: $('#insurancenumber').val(),
                                                FamilyType: $('#familytype').val(),
                                                Noreg: $('#noregfamily').val(),
                                                Nik: $('#eniks').val(),
                                                //PhoneNumber: $('#efphoneCode').val() + ' ' + $('#efphone').val(),
                                                PhoneNumber: $('#efphone').val() ? ($('#efphoneCode').val() + ' ' + $('#efphone').val()) : '',
                                                Job: $('#efjob').val(),
                                                LifeStatus: parseInt($('#efLifeStatus').val()),
                                                DeathDate: $('#efDeathDate').data('kendoDatePicker').value() ?
                                                    kendo.toString($('#efDeathDate').data('kendoDatePicker').value(), "yyyy/MM/dd") : null,
                                                Religion: $('#efreligion').val(),
                                                Nationality: $('#efnationality').val(),
                                                EducationLevel: $('#efeducationLevels').val(),
                                                Domicile: $('#efdomicile').val(),
                                                AddressStatusCode: $('#efresidentialStatus').val(),
                                            };

                                            $.ajax({
                                                url: '@Url.Content("~/api/employe-profile/updatefamilymember")',
                                                type: 'POST',
                                                contentType: 'application/json',
                                                data: JSON.stringify(familyDataedit),
                                                success: function (response) {
                                                    app.success("@Localizer["Family details updated successfully."]", "");
                                                    $('#FamilyModal').modal('hide');
                                                    location.reload();
                                                },
                                                error: function () {
                                                    app.error("@Localizer["Failed to update family details."]", "");
                                                }
                                            });
                                        }
                                    });

                                    return false;
                                });
                            });
                        </script>

                        <div id="EC" class="tabcontent">

                            <div class="card-body" style="padding-top: 0px">

                                @* @(
                                    Html.Kendo().Grid<PersonalDataAllProfileStoredEntity>(ListProfileData)
                                    .Name("personaldataGrid")
                                    .HtmlAttributes(new { @class = "not-hoverable table-fixed-header", @style = "font-size:0.8rem" })
                                    .Columns(columns =>
                                    {
                                        columns.Bound(c => c.NoReg).Title("No Reg");
                                        columns.Bound(c => c.Name).Title("Name");
                                        columns.Bound(c => c.Gender).Title("Gender");
                                    })
                                    .DataSource(dataSource =>
                                    dataSource
                                    .Ajax()
                                    .Read(read => read.Url(Url.Content("~/api/personaldata/get")))
                                    )
                                    ) *@

                                <br />

                                <form id="emergencyContactForm" method="post" enctype="multipart/form-data">
                                    <input type="hidden" name="NoReg" value="@ViewData["NoReg"]" />
                                    <style>
                                        .error-border {
                                            border: 2px solid red !important;
                                        }
                                    </style>

                                    <div class="row">
                                        <!-- Left Side -->
                                        <div class="col-md-6">

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="profileData">Family Contact Name</label>
                                                <input type="text" class="form-control" id="ecContactName" name="ecContactName" value="@ViewData["ecName"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="phone">Family Contact Number</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <select class="form-control" id="ecphoneCode" name="ecphoneCode" style="max-width: 100px;" disabled>
                                                            @{
                                                                var ecphone = ViewData["ecPhone"]?.ToString() ?? "";
                                                            }
                                                            @foreach (var code in ViewData["ecPhoneList"] as List<string>)
                                                            {
                                                                <option value="@code" selected="@(code == ViewData["ecPhoneCode"]?.ToString() ? "selected" : null)">
                                                                    @code
                                                                </option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <input type="text" class="form-control" id="ecphone" name="ecphone" value="@ecphone" disabled />
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none">* </span><label for="familytype" class="form-label">Family Contact Relationship</label>
                                                <select class="form-control" id="ecfamilytype" disabled>
                                                    <option value="">Select Family Type</option>
                                                    @{
                                                        var selectedRelation = ViewData["ecRelation"]?.ToString();
                                                    }
                                                    @foreach (var familyType in (IEnumerable<string>)ViewData["familyTypeList"])
                                                    {
                                                        <option value="@familyType" selected="@(familyType == selectedRelation ? "selected" : null)">
                                                            @familyType
                                                        </option>
                                                    }
                                                </select>
                                            </div>

                                        </div>


                                        <!-- Right Side -->
                                        <div class="col-md-6">

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="profileData">Family Contact Name 2</label>
                                                <input type="text" class="form-control" id="ecContactName2" name="ecContactName2" value="@ViewData["ecName2"]?.ToString()" disabled />
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none" class="mandatory-asterisk">* </span><label for="phone">Family Contact Number 2</label>
                                                <div class="input-group">
                                                    <div class="input-group-prepend">
                                                        <select class="form-control" id="ecphoneCode2" name="ecphoneCode2" style="max-width: 100px;" disabled>
                                                            @{
                                                                var ecphone2 = ViewData["ecPhone2"]?.ToString() ?? "";
                                                            }
                                                            @foreach (var code in ViewData["ecPhoneList"] as List<string>)
                                                            {
                                                                <option value="@code" selected="@(code == ViewData["ecPhoneCode2"]?.ToString() ? "selected" : null)">
                                                                    @code
                                                                </option>
                                                            }
                                                        </select>
                                                    </div>
                                                    <input type="text" class="form-control" id="ecphone2" name="ecphone2" value="@ecphone2" disabled />
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <span style="color: red; display: none">* </span><label for="familytype" class="form-label">Family Contact Relationship 2</label>
                                                <select class="form-control" id="ecfamilytype2" disabled>
                                                    <option value="">Select Family Type</option>
                                                    @{
                                                        var selectedRelation2 = ViewData["ecRelation2"]?.ToString();
                                                    }
                                                    @foreach (var familyType in (IEnumerable<string>)ViewData["familyTypeList"])
                                                    {
                                                        <option value="@familyType" selected="@(familyType == selectedRelation2 ? "selected" : null)">
                                                            @familyType
                                                        </option>
                                                    }
                                                </select>
                                            </div>

                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary" id="ecButton" style="float:right; margin-right:20px;" @(isTerminated ? "disabled" : "")>
                                        <i class="fa fa-pencil"></i> Edit Contact
                                    </button>

                                    <button type="button" class="btn btn-danger" id="cancelcontactButton" hidden style="float:right; margin-left:10px; bottom:0px;">Cancel</button>

                                    <button type="submit" class="btn btn-primary" id="savecontactButton" hidden style="float:right; bottom:0px;">Save</button>

                                    <br />

                                </form>

                            </div>
                            <div class="col-sm-12">
                                <div class="p-0 table-responsive">
                                </div>
                            </div>
                        </div>

                        <script>
                            const ecEditButton = document.getElementById('ecButton');
                            const ecSaveButton = document.getElementById('savecontactButton');
                            const ecCancelButton = document.getElementById('cancelcontactButton');

                            const ecInputs = [
                                document.getElementById('ecContactName'),
                                document.getElementById('ecphone'),
                                document.getElementById('ecphoneCode'),
                                document.getElementById('ecfamilytype'),
                                document.getElementById('ecContactName2'),
                                document.getElementById('ecphone2'),
                                document.getElementById('ecphoneCode2'),
                                document.getElementById('ecfamilytype2')
                            ];

                            const ecOriginalValues = {};
                            ecInputs.forEach(input => {
                                if (input) ecOriginalValues[input.id] = input.value;
                            });

                            ecEditButton.addEventListener('click', function () {
                                ecInputs.forEach(input => {
                                    if (input) input.disabled = false;
                                });

                                ecSaveButton.hidden = false;
                                ecCancelButton.hidden = false;
                                ecEditButton.hidden = true;
                            });

                            ecCancelButton.addEventListener('click', function () {
                                ecInputs.forEach(input => {
                                    if (input) {
                                        input.value = ecOriginalValues[input.id] || '';
                                        input.disabled = true;
                                    }
                                });

                                ecSaveButton.hidden = true;
                                ecCancelButton.hidden = true;
                                ecEditButton.hidden = false;
                            });
                        </script>

                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                document.getElementById("emergencyContactForm").addEventListener("submit", function (event) {
                                    event.preventDefault(); // Prevent default form submission

                                    let form = document.getElementById("emergencyContactForm");

                                    // Check if required fields are filled
                                    if (!form.checkValidity()) {
                                        form.reportValidity(); // Show validation messages
                                        return false; // Stop submission
                                    }

                                    // If valid, show confirmation alert
                                    app.confirm("@Localizer["Are you sure you want to update Emergency Contact?"]", function (d) {
                                        if (d.value) {
                                            // Collect form data
                                            var EmcEdits = {
                                                Noreg: $('#noreg').val(),
                                                EmergencyCallName: $('#ecContactName').val(),
                                                EmergencyCallPhoneNumber: ($('#ecphoneCode').val() || '') + ' ' + ($('#ecphone').val() || ''),
                                                EmergencyCallRelationshipCode: $('#ecfamilytype').val(),
                                                EmergencyCallName2: $('#ecContactName2').val(),
                                                EmergencyCallPhoneNumber2: ($('#ecphoneCode2').val() || '') + ' ' + ($('#ecphone2').val() || ''),
                                                EmergencyCallRelationshipCode2: $('#ecfamilytype2').val()
                                            };

                                            // API URL
                                            var url = '@Url.Content("~/api/employe-profile/updateemergencycontact")';

                                            // Call the API
                                            $.ajax({
                                                url: url,
                                                type: 'POST',
                                                contentType: 'application/json',
                                                data: JSON.stringify(EmcEdits),
                                                success: function (response) {
                                                    app.success("@Localizer["Emergency Contact updated successfully."]", "");
                                                    location.reload();
                                                },
                                                error: function (xhr, status, error) {
                                                    app.error("@Localizer["Failed to update Emergency Contact."]", "");
                                                }
                                            });
                                        }
                                    });

                                    return false; // Prevent default form submission
                                });
                            });
                        </script>

                        <div id="TE" class="tabcontent">
                            @(
                                Html.Kendo().Grid(training)
                                .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                .Name("trainingEventGrid")
                                .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                .Pageable(options =>
                                {
                                    options.Input(true);
                                    options.Numeric(false);
                                    options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                })
                                .Scrollable(s => s.Enabled(true).Height("auto"))
                                .Resizable(resizable => resizable.Columns(true))
                                .Columns(columns =>
                                {
                                    columns.Bound("Year").Title("Year").Width(221).HtmlAttributes(new { @class = "text-center" });
                                    columns.Bound("TrainingName").Title("Training Name").Width(221);
                                    columns.Bound("Institution").Title("Institution").Width(221);
                                })
                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No personal development found"].Value + "</div>"))
                                .Deferred()
                                )
                        </div>
                        <div id="MH" class="tabcontent">
                            @(Html.Kendo().Grid<TAMHR.ESS.Domain.PersonalDataMedicalHistory>()
                                .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                .Name("medicalHistoryGrid")
                                .Columns(columns =>
                                {
                                    columns.Bound(x => x.YearPeriod).Title("Period").Width(100);
                                    columns.Bound(x => x.GlukosaPuasa).Title("Glukosa Puasa").Width(100);
                                    columns.Bound(x => x.SGOT).Title("SGOT").Width(100);
                                    columns.Bound(x => x.SGPT).Title("SGPT").Width(100);
                                    columns.Bound(x => x.HBsAg).Title("HbsAg").Width(100);
                                    columns.Bound(x => x.AntiHBs).Title("Anti HBs").Width(100);
                                    columns.Bound(x => x.AsamUrat).Title("Urid Acid").Width(100);
                                    columns.Bound(x => x.KolesterolTotal).Title("Total Cholesterol").Width(150);
                                    columns.Bound(x => x.StatusBMI).Title("BMI Status").Width(100);
                                    columns.Bound(x => x.TekananDarah).Title("Blood Pressure").Width(150);
                                    columns.Bound(x => x.Kreatinin).Title("Creatinine").Width(100);
                                    columns.Bound(x => x.HasilEKG).Title("ECG Results").Width(100);
                                    columns.Bound(x => x.HasilRontgen).Title("X-ray Results").Width(150);
                                    columns.Bound(x => x.HealthEmployeeStatus).Title("Health Employee Status").Width(150);
                                })
                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No personal development found"].Value + "</div>"))
                                .DataSource(dataSource => dataSource
                                .Ajax()
                                .Read(read => read.Url(Url.Content("~/api/employe-profile/get-medical-histories-1")).Data(@<text>function() { return { noreg: "@ProfileData.NoReg" }; }</text>))
                                .Sort(sort => sort.Add("YearPeriod").Descending())
                                ).Pageable(options =>
                                {
                                    options.Input(true);
                                    options.Numeric(false);
                                    options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                })
                                .Resizable(resizable => resizable.Columns(true))
                                .Scrollable(s => s.Enabled(true).Height("auto"))
                                .Deferred()
                                )

                        </div>
                        <div id="PD" class="tabcontent">
                            @(Html.Kendo().Grid<TAMHR.ESS.Domain.PerformanceDevelopment>()
                                            .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                                .Name("performanceDevelopmentGrid")
                                                .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                                .Columns(columns =>
                                                {
                                                    columns.Bound(x => x.Period).Title("Period").Width(70);
                                                    columns.Bound(x => x.AreaDevelopment).Title("Area Development").HtmlAttributes(new { @class = "text-center" }).Width(100);
                                                    columns.Bound(x => x.GeneralDevCategory).Title("Dev. Category").Width(250);
                                                    columns.Bound(x => x.DevelopmentActivity).Title("Dev. Activity").Width(250);
                                                    columns.Bound(x => x.Mentor).Title("Mentor").Width(250);
                                                    columns.Bound(x => x.Target).Title("Target").Width(250);
                                                    columns.Bound(x => x.StartDate).Title("StartDate").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(100);
                                                    columns.Bound(x => x.EndDate).Title("EndDate").Format("{0:dd/MM/yyyy}").HtmlAttributes(new { @class = "text-center" }).Width(100);
                                                })
                                                .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No personal development found"].Value + "</div>"))
                                                .DataSource(dataSource => dataSource
                                                .Ajax()
                                                .Read(read => read.Url(Url.Content("~/api/employe-profile/get-performance-developments")).Data(@<text>function() { return { noreg: "@ProfileData.NoReg" }; }</text>))
                                                .Sort(sort => sort.Add("Period").Descending())
                                                )
                                                .Pageable(options =>
                                                {
                                                    options.Input(true);
                                                    options.Numeric(false);
                                                    options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                                })
                                                .Resizable(resizable => resizable.Columns(true))
                                                .Scrollable(s => s.Enabled(true).Height("auto"))
                                                .Deferred()
                                                )
                        </div>
                        <div id="HBC" class="tabcontent">
                            <div id="historyBenefitClaim" aria-labelledby="headingThree">
                                <div class="card-body">
                                    <div class="form-group">
                                        <div class="row">
                                            <label style="margin-right: 5px;">Claim Type:</label>
                                            <select id="claimTypeDropdown">
                                                @foreach (var claimType in claimTypes)
                                                {
                                                    <option>@claimType</option>
                                                }
                                            </select>
                                        </div>
                                        <div style="margin-bottom:62px;margin-top:10px;">
                                            <a class="btn btn-primary" onclick="filterGrid23();" style="color: #fff; float:right;">
                                                <i class="ft-search"></i> &nbsp;@Localizer["Search"]
                                            </a>
                                        </div>
                                    </div>
                                    @*<div id="benefitClaimGrid1"></div>*@
                                    @(Html.Kendo().Grid<HistoryClaimStoreEntity>(HBC)
                                            .Name("HCBGrid")
                                            .HtmlAttributes(new { @class = "not-hoverable table-fixed-header" })
                                            .HtmlAttributes(new { @style = "font-size:0.9rem" })
                                            .Pageable(options =>
                                            {
                                                options.Input(true);
                                                options.Numeric(false);
                                                options.PageSizes(new[] { 5, 10, 20, 25, 100, 200 });
                                            })
                                            .Scrollable(s => s.Enabled(true).Height("auto"))
                                            .Resizable(resizable => resizable.Columns(true))
                                            .Columns(columns =>
                                            {
                                                columns.Bound(x => x.AllowanceType).Title("Type of Benefit Claim").Width(150);
                                                columns.Bound(x => x.Noreg).Title("Claim Transactions").ClientTemplate(@"#= monthActivity # #= yearActivity#").Width(200);
                                                columns.Bound(x => x.JsonObject).Title("Patient's name").ClientTemplate(@"#var obj = JSON.parse(JsonObject)#<text>#: obj.FamilyName #</text>").Hidden().HtmlAttributes(new { id = "namaPasienColumn" }).Width(200);
                                                columns.Bound(x => x.JsonObject).Title("Relationshiop").ClientTemplate(@"#var obj = JSON.parse(JsonObject)#<text>#if (obj.FamilyType === 'rspasangan') { #
                                                    Pasangan
                                                # } else if (obj.FamilyType === 'rskaryawan') { #
                                                    Diri Sendiri
                                                # } else if (obj.FamilyType === 'rsanak') { #
                                                    Anak
                                                # }  #</text>").Hidden().HtmlAttributes(new { id = "namaHubunganColumn" }).Width(200);
                                                columns.Bound(x => x.JsonObject).Title("Reimbursement Type").ClientTemplate(@"#var obj = JSON.parse(JsonObject)#<text>#: (obj.ReimburseType == 'rawatjalankontrol' ? 'Rawat Jalan / Kontrol' : 'Perawatan / Inap') #</text>").Hidden().HtmlAttributes(new { id = "namaTipeReimburse"}).Width(200);
                                                columns.Bound(x => x.JsonObject).Title("Hospital Name").ClientTemplate(@"#var obj = JSON.parse(JsonObject)#<text>#: obj.HospitalName#</text>").Hidden().HtmlAttributes(new {id = "namaHospitalColumn"}).Width(200);
                                                columns.Bound(x => x.JsonObject).Title("Date of Treatment").ClientTemplate(@"#var obj = JSON.parse(JsonObject)#<text>#: (obj.DateIn == obj.DateOut ? obj.DateIn : (obj.DateIn)) #</text>").Hidden().HtmlAttributes(new {id = "namaTanggal Perawatan"}).Width(200);
                                                columns.Bound(x => x.amount).Title("Amount Transaction Claims").Format("Rp.{0:n0}").Width(150);
                                            })
                                        .NoRecords(config => config.Template(@"<div class=""text-center p-2 text-muted""><i class=""fa fa-clipboard font-large-1""></i><br/>" + Localizer["No History Benefit Claim found"].Value + "</div>"))
                                        .Deferred()
                                    )
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



