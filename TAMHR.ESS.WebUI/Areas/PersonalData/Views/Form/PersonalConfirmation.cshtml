@using TAMHR.ESS.Infrastructure
@model DocumentRequestDetailViewModel<PersonalDataConfirmationViewModel>
@inject TAMHR.ESS.Infrastructure.DomainServices.PersonalDataQueryService PersonalDataQueryService
@{
    bool isCanEdit = AclHelper.CanEdit();

    var isNew = Model.Id == default;

    var displayName = User.GetClaim("Name");

    if (isNew)
    {
        var noreg = User.GetClaim("NoReg");
        var keyDate = DateTime.Now.Date;

        Model.Object = PersonalDataQueryService.GetPersonalDataConfirmationViewModels(noreg, keyDate);
    }

    var groups = Model.Object.Groups.GroupBy(x => new { x.Group, x.Url });
}
@section scripts {
    <script type="text/javascript">
        (function () {
            $("main.page-content-wrapper").css("overflow", "inherit");
        })(jQuery);
    </script>
}
<div class="card">
    <div class="row no-gutters">
        <div class="col-md-4">
            <div class="p-4" style="height: 100%; background-color: #f8f9fa;">
                <div class="section-heading d-block d-md-none">
                    <p class="text-uppercase font-weight-bold mb-0">@Localizer["Personal Data and Hobbies Form"]</p>
                    <h5 class="text-header m-0">
                        @Localizer["PersonalConfirmation.PlaceholderTitle"]
                    </h5>
                </div>
                <div class="d-none d-md-flex align-items-center h-100">
                    <img src="~/img/assets/asset-12.png" alt="login" class="mx-auto my-5" style="width: 90%;">
                </div>
            </div>
        </div>
        <div class="col-md-8 col-12">
            <div class="card-body">
                <div class="section-heading mb-2 d-none d-md-block">
                    <p class="text-uppercase font-weight-bold mb-0">@Localizer["Personal Data Confirmation Form for {0}", displayName]</p>
                    <h5 class="text-header m-0">
                        @Localizer["PersonalConfirmation.PlaceholderTitle"]
                    </h5>
                </div>
                <div class="mb-2">@Html.Raw(Localizer["PersonalConfirmation.PlaceholderDescription"].Value)</div>
            </div>
        </div>
    </div>
</div>
@foreach (var group in groups)
{
    <div class="card">
        <div class="row no-gutters">
            <div class="col-md-4">
                <div class="section-heading p-4" style="background-color: #f8f9fa; height: 100%; position: relative;">
                    <div class="position-md-sticky">
                        <p class="text-uppercase font-weight-bold mb-0">@Localizer[group.Key.Group]</p>
                        <h5 class="text-header m-0">
                            @(!string.IsNullOrEmpty(group.Key.Url) ? Localizer[@"Update your information by clicking <a href=""{0}"" target=""_blank"">this link.</a>", Url.Content(group.Key.Url)] : Localizer["Your {0} information", group.Key.Group])
                        </h5>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <div class="row material">
                        @foreach (var input in group)
                        {
                            <div class="form-group col-md-12">
                                <label>@Localizer[input.Field]</label>
                                <input name="Object.Groups[][Group]" class="form-control" value="@input.Group" type="hidden" />
                                <input name="Object.Groups[][Field]" class="form-control" value="@input.Field" type="hidden" />
                                <input name="Object.Groups[][Value]" class="form-control" value="@input.Value" type="text" readonly="readonly" />
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section formActions
{
    @if (AclHelper.CanViewAction())
    {
        var canSubmit = AclHelper.CanSubmit();
        <div class="row mb-5">
            <div class="col-9 col-sm-8 d-flex align-items-center">
                @if (canSubmit)
                {
                    <div class="custom-control custom-checkbox mb-2">
                        <input type="checkbox" name="Object.Confirmation" id="cb_confirmation" class="custom-control-input" value="True" />
                        <label class="custom-control-label" for="cb_confirmation"></label> @Localizer["PersonalConfirmation.ConfirmationPlaceholder"]
                    </div>
                }
                else
                {
                    <label>@Localizer["Send Update?"]</label>
                }
            </div>
            <div class="col-3 col-sm-4">
                <div class="float-right">
                    @if (canSubmit)
                    {
                        <a class="btn btn-primary" href="#" data-trigger="submit" data-target-form="mainForm" data-confirmation="true" data-confirmationmsg="@Localizer["Do you want to submit this document?"]" data-callback="submitHandler" data-parameters-id="@Model.DocumentApprovalId" data-parameters-action="initiate" data-interceptor="dataInterceptor" data-draft="false">
                            <i class="ft-check mr-1"></i> @Localizer["Submit"]
                        </a>
                    }
                    @if (AclHelper.CanApprove())
                    {
                        <a class="btn btn-success mr-2" href="#" data-trigger="handler" data-handler="postHandler" data-parameters-id="@Model.DocumentApprovalId" data-parameters-action="approve" data-interceptor="dataInterceptor" data-parameters-redirecturl="~/core/home/tasks">
                            <i class="ft-check"></i> <span class="d-none d-md-inline">@Localizer["Approve"]</span>
                        </a>
                    }
                    @if (AclHelper.CanReject())
                    {
                        <a class="btn btn-danger" href="#" data-trigger="handler" data-handler="postHandler" data-parameters-id="@Model.DocumentApprovalId" data-parameters-action="reject" data-interceptor="dataInterceptor" data-parameters-redirecturl="~/core/home/tasks">
                            <i class="ft-x"></i> <span class="d-none d-md-inline">@Localizer["Reject"]</span>
                        </a>
                    }
                </div>
            </div>
        </div>
    }
}